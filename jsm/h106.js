THREE.OrbitControls=function(e,t){var a,n,o,i,r;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.LEFT,MIDDLE:THREE.MOUSE.MIDDLE,RIGHT:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return h.phi},this.getAzimuthalAngle=function(){return h.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(l),s.update(),p=d.NONE},this.update=(a=new THREE.Vector3,n=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),o=n.clone().inverse(),i=new THREE.Vector3,r=new THREE.Quaternion,function(){var e=s.object.position;return a.copy(e).sub(s.target),a.applyQuaternion(n),h.setFromVector3(a),s.autoRotate&&p===d.NONE&&H(2*Math.PI/60/60*s.autoRotateSpeed),h.theta+=f.theta,h.phi+=f.phi,h.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,h.theta)),h.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,h.phi)),h.makeSafe(),h.radius*=g,h.radius=Math.max(s.minDistance,Math.min(s.maxDistance,h.radius)),s.target.add(v),a.setFromSpherical(h),a.applyQuaternion(o),e.copy(s.target).add(a),s.object.lookAt(s.target),!0===s.enableDamping?(f.theta*=1-s.dampingFactor,f.phi*=1-s.dampingFactor,v.multiplyScalar(1-s.dampingFactor)):(f.set(0,0,0),v.set(0,0,0)),g=1,!!(b||i.distanceToSquared(s.object.position)>m||8*(1-r.dot(s.object.quaternion))>m)&&(s.dispatchEvent(l),i.copy(s.object.position),r.copy(s.object.quaternion),!(b=!1))}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",Y,!1),s.domElement.removeEventListener("mousedown",z,!1),s.domElement.removeEventListener("wheel",G,!1),s.domElement.removeEventListener("touchstart",q,!1),s.domElement.removeEventListener("touchend",U,!1),s.domElement.removeEventListener("touchmove",V,!1),document.removeEventListener("mousemove",F,!1),document.removeEventListener("mouseup",W,!1),window.removeEventListener("keydown",Z,!1)};var s=this,l={type:"change"},c={type:"start"},u={type:"end"},d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},p=d.NONE,m=1e-6,h=new THREE.Spherical,f=new THREE.Spherical,g=1,v=new THREE.Vector3,b=!1,y=new THREE.Vector2,E=new THREE.Vector2,w=new THREE.Vector2,M=new THREE.Vector2,_=new THREE.Vector2,T=new THREE.Vector2,R=new THREE.Vector2,x=new THREE.Vector2,C=new THREE.Vector2;function S(){return Math.pow(.95,s.zoomSpeed)}function H(e){f.theta-=e}function I(e){f.phi-=e}var O,D,k,L=(O=new THREE.Vector3,function(e,t){O.setFromMatrixColumn(t,0),O.multiplyScalar(-e),v.add(O)}),P=(D=new THREE.Vector3,function(e,t){!0===s.screenSpacePanning?D.setFromMatrixColumn(t,1):(D.setFromMatrixColumn(t,0),D.crossVectors(s.object.up,D)),D.multiplyScalar(e),v.add(D)}),A=(k=new THREE.Vector3,function(e,t){var a,n=s.domElement===document?s.domElement.body:s.domElement;s.object.isPerspectiveCamera?(a=s.object.position,k.copy(a).sub(s.target),a=k.length(),a*=Math.tan(s.object.fov/2*Math.PI/180),L(2*e*a/n.clientHeight,s.object.matrix),P(2*t*a/n.clientHeight,s.object.matrix)):s.object.isOrthographicCamera?(L(e*(s.object.right-s.object.left)/s.object.zoom/n.clientWidth,s.object.matrix),P(t*(s.object.top-s.object.bottom)/s.object.zoom/n.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)});function j(e){s.object.isPerspectiveCamera?g/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),b=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function N(e){s.object.isPerspectiveCamera?g*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),b=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function B(e){M.set(e.clientX,e.clientY)}function z(e){if(!1!==s.enabled){switch(e.preventDefault(),(s.domElement.focus?s.domElement:window).focus(),e.button){case s.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enablePan)return;B(e),p=d.PAN}else{if(!1===s.enableRotate)return;t=e,y.set(t.clientX,t.clientY),p=d.ROTATE}break;case s.mouseButtons.MIDDLE:if(!1===s.enableZoom)return;t=e,R.set(t.clientX,t.clientY),p=d.DOLLY;break;case s.mouseButtons.RIGHT:if(!1===s.enablePan)return;B(e),p=d.PAN}var t;p!==d.NONE&&(document.addEventListener("mousemove",F,!1),document.addEventListener("mouseup",W,!1),s.dispatchEvent(c))}}function F(e){var t,a;if(!1!==s.enabled)switch(e.preventDefault(),p){case d.ROTATE:if(!1===s.enableRotate)return;a=e,E.set(a.clientX,a.clientY),w.subVectors(E,y).multiplyScalar(s.rotateSpeed),a=s.domElement===document?s.domElement.body:s.domElement,H(2*Math.PI*w.x/a.clientHeight),I(2*Math.PI*w.y/a.clientHeight),y.copy(E),s.update();break;case d.DOLLY:if(!1===s.enableZoom)return;t=e,x.set(t.clientX,t.clientY),C.subVectors(x,R),0<C.y?j(S()):C.y<0&&N(S()),R.copy(x),s.update();break;case d.PAN:if(!1===s.enablePan)return;t=e,_.set(t.clientX,t.clientY),T.subVectors(_,M).multiplyScalar(s.panSpeed),A(T.x,T.y),M.copy(_),s.update()}}function W(e){!1!==s.enabled&&(document.removeEventListener("mousemove",F,!1),document.removeEventListener("mouseup",W,!1),s.dispatchEvent(u),p=d.NONE)}function G(e){!1===s.enabled||!1===s.enableZoom||p!==d.NONE&&p!==d.ROTATE||(e.preventDefault(),e.stopPropagation(),s.dispatchEvent(c),(e=e).deltaY<0?N(S()):0<e.deltaY&&j(S()),s.update(),s.dispatchEvent(u))}function Z(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){var t=!1;switch(e.keyCode){case s.keys.UP:A(0,s.keyPanSpeed),t=!0;break;case s.keys.BOTTOM:A(0,-s.keyPanSpeed),t=!0;break;case s.keys.LEFT:A(s.keyPanSpeed,0),t=!0;break;case s.keys.RIGHT:A(-s.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),s.update())}(e)}function q(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===s.enableRotate)return;n=e,y.set(n.touches[0].pageX,n.touches[0].pageY),p=d.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;t=e,s.enableZoom&&(n=t.touches[0].pageX-t.touches[1].pageX,a=t.touches[0].pageY-t.touches[1].pageY,a=Math.sqrt(n*n+a*a),R.set(0,a)),s.enablePan&&(a=.5*(t.touches[0].pageX+t.touches[1].pageX),t=.5*(t.touches[0].pageY+t.touches[1].pageY),M.set(a,t)),p=d.TOUCH_DOLLY_PAN;break;default:p=d.NONE}var t,a,n;p!==d.NONE&&s.dispatchEvent(c)}}function V(e){var t,a,n;if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===s.enableRotate)return;if(p!==d.TOUCH_ROTATE)return;n=e,E.set(n.touches[0].pageX,n.touches[0].pageY),w.subVectors(E,y).multiplyScalar(s.rotateSpeed),n=s.domElement===document?s.domElement.body:s.domElement,H(2*Math.PI*w.x/n.clientHeight),I(2*Math.PI*w.y/n.clientHeight),y.copy(E),s.update();break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;if(p!==d.TOUCH_DOLLY_PAN)return;t=e,s.enableZoom&&(n=t.touches[0].pageX-t.touches[1].pageX,a=t.touches[0].pageY-t.touches[1].pageY,a=Math.sqrt(n*n+a*a),x.set(0,a),C.set(0,Math.pow(x.y/R.y,s.zoomSpeed)),j(C.y),R.copy(x)),s.enablePan&&(a=.5*(t.touches[0].pageX+t.touches[1].pageX),t=.5*(t.touches[0].pageY+t.touches[1].pageY),_.set(a,t),T.subVectors(_,M).multiplyScalar(s.panSpeed),A(T.x,T.y),M.copy(_)),s.update();break;default:p=d.NONE}}function U(e){!1!==s.enabled&&(s.dispatchEvent(u),p=d.NONE)}function Y(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",Y,!1),s.domElement.addEventListener("mousedown",z,!1),s.domElement.addEventListener("wheel",G,!1),s.domElement.addEventListener("touchstart",q,!1),s.domElement.addEventListener("touchend",U,!1),s.domElement.addEventListener("touchmove",V,!1),window.addEventListener("keydown",Z,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=(window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.']:['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.']).join("\n")),e},addGetWebGLMessage:function(e){var t=void 0!==(e=e||{}).parent?e.parent:document.body,a=void 0!==e.id?e.id:"oldie";(e=Detector.getWebGLErrorMessage()).id=a,t.appendChild(e)}};"object"==typeof module&&(module.exports=Detector);var Stats=function(){function e(e){return n.appendChild(e.dom),e}function t(e){for(var t=0;t<n.children.length;t++)n.children[t].style.display=t===e?"block":"none";a=e}var a=0,n=document.createElement("div");n.style.cssText="position:fixed;top:60px;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(e){e.preventDefault(),t(++a%n.children.length)},!1);var o,i=(performance||Date).now(),r=i,s=0,l=e(new Stats.Panel("FPS","#0ff","#002")),c=e(new Stats.Panel("MS","#0f0","#020"));return self.performance&&self.performance.memory&&(o=e(new Stats.Panel("MB","#f08","#201"))),t(0),{REVISION:16,dom:n,addPanel:e,showPanel:t,begin:function(){i=(performance||Date).now()},end:function(){s++;var e,t=(performance||Date).now();return c.update(t-i,200),r+1e3<t&&(l.update(1e3*s/(t-r),100),r=t,s=0,o)&&(e=performance.memory,o.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)),t},update:function(){i=this.end()},domElement:n,setMode:t}};Stats.Panel=function(a,n,o){var i=1/0,r=0,s=Math.round,l=s(window.devicePixelRatio||1),c=220*l,e=48*l,u=3*l,d=2*l,p=3*l,m=15*l,h=214*l,f=30*l,g=document.createElement("canvas");g.width=c,g.height=e,g.style.cssText="width:220px;height:48px";var v=g.getContext("2d");return v.font="bold "+9*l+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=o,v.fillRect(0,0,c,e),v.fillStyle=n,v.fillText(a,u,d),v.fillRect(p,m,h,f),v.fillStyle=o,v.globalAlpha=.9,v.fillRect(p,m,h,f),{dom:g,update:function(e,t){i=Math.min(i,e),r=Math.max(r,e),v.fillStyle=o,v.globalAlpha=1,v.fillRect(0,0,c,m),v.fillStyle=n,v.fillText(s(e)+" "+a+" ("+s(i)+"-"+s(r)+")",u,d),v.drawImage(g,p+l,m,h-l,f,p,m,h-l,f),v.fillRect(p+h-l,m,l,f),v.fillStyle=o,v.globalAlpha=.9,v.fillRect(p+h-l,m,l,s((1-e/t)*f))}}},"object"==typeof module&&(module.exports=Stats),THREE.SceneLoader=function(e){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.byRequest=!1},THREE.SceneLoader.prototype={constructor:THREE.SceneLoader,load:function(t,a,e,n){var o=this;new THREE.FileLoader(o.manager).load(t,function(e){o.parse(JSON.parse(e),a,t)},e,n)},addGeometryHandler:function(e,t){this.geometryHandlers[e]={loaderClass:t}},addHierarchyHandler:function(e,t){this.hierarchyHandlers[e]={loaderClass:t}},parse:function(e,a,t){var E,w,M,n,_,i,o,r,s,T,R=this,l=THREE.LoaderUtils.extractUrlBase(t);this.urlBase=l;var c=[],u=[],d=[];this.materialsInMeshs=u,this.texturesInMaterials=d;var p,x=e;for(p in this.data=x,this.geometryHandlers){var m=this.geometryHandlers[p].loaderClass;this.geometryHandlers[p].loaderObject=new m}for(p in this.hierarchyHandlers){m=this.hierarchyHandlers[p].loaderClass;this.hierarchyHandlers[p].loaderObject=new m}function h(){!function e(t,a){var n,o,i,r;for(var s in a){var l,c=T.objects[s],u=a[s];if(void 0===c){if(u.type&&u.type in R.hierarchyHandlers)void 0===u.loading&&(w=T.materials[u.material],u.loading=!0,(l=R.hierarchyHandlers[u.type].loaderObject).options,l.load(R.get_url(u.url,x.urlBaseType),C(s,t,w,u)));else if(void 0!==u.geometry)(E=T.geometries[u.geometry])&&(w=T.materials[u.material],n=u.position||[0,0,0],o=u.rotation||[0,0,0],i=u.scale||[1,1,1],l=u.matrix,r=u.quaternion,u.material||(w=new THREE.MultiMaterial(T.face_materials[u.geometry])),w instanceof THREE.MultiMaterial&&0===w.materials.length&&(w=new THREE.MultiMaterial(T.face_materials[u.geometry])),u.skin?c=new THREE.SkinnedMesh(E,w):u.morph?(c=new THREE.MorphAnimMesh(E,w),void 0!==u.duration&&(c.duration=u.duration),void 0!==u.time&&(c.time=u.time),void 0!==u.mirroredLoop&&(c.mirroredLoop=u.mirroredLoop),w.morphNormals&&E.computeMorphNormals()):c=new THREE.Mesh(E,w),c.name=s,l?(c.matrixAutoUpdate=!1,c.matrix.set(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8],l[9],l[10],l[11],l[12],l[13],l[14],l[15])):(c.position.fromArray(n),r?c.quaternion.fromArray(r):c.rotation.fromArray(o),c.scale.fromArray(i)),c.visible=u.visible,c.castShadow=u.castShadow,c.receiveShadow=u.receiveShadow,t.add(c),T.objects[s]=c);else if("AmbientLight"===u.type||"PointLight"===u.type||"DirectionalLight"===u.type||"SpotLight"===u.type||"HemisphereLight"===u.type){var d=u.color,p=u.intensity,m=u.distance,h=u.position,f=u.rotation;switch(u.type){case"AmbientLight":_=new THREE.AmbientLight(d,p);break;case"PointLight":(_=new THREE.PointLight(d,p,m)).position.fromArray(h);break;case"DirectionalLight":(_=new THREE.DirectionalLight(d,p)).position.fromArray(u.direction);break;case"SpotLight":(_=new THREE.SpotLight(d,p,m)).angle=u.angle,_.position.fromArray(h),_.target.set(h[0],h[1]-m,h[2]),_.target.applyEuler(new THREE.Euler(f[0],f[1],f[2],"XYZ"));break;case"HemisphereLight":(_=new THREE.DirectionalLight(d,p,m)).target.set(h[0],h[1]-m,h[2]),_.target.applyEuler(new THREE.Euler(f[0],f[1],f[2],"XYZ"))}t.add(_),_.name=s,T.lights[s]=_,T.objects[s]=_}else if("CombinedCamera"===u.type||"PerspectiveCamera"===u.type||"OrthographicCamera"===u.type){if(n=u.position||[0,0,0],o=u.rotation||[0,0,0],r=u.quaternion,"PerspectiveCamera"===u.type?M=new THREE.PerspectiveCamera(u.fov,u.aspect,u.near,u.far):"OrthographicCamera"===u.type?M=new THREE.OrthographicCamera(u.left,u.right,u.top,u.bottom,u.near,u.far):"CombinedCamera"===u.type&&(M=new THREE.CombinedCamera(u.left,u.right,u.top,u.bottom,u.near,u.far)),M.name=s,M.section_view=u.section_view,M.autoZoom=u.autoZoom,M.position.fromArray(n),void 0!==r?M.quaternion.fromArray(r):void 0!==o&&M.rotation.fromArray(o),u.target&&(M.lookAt((new THREE.Vector3).fromArray(u.target)),M.target=(new THREE.Vector3).fromArray(u.target)),u.section_view&&(M.section_view=u.section_view),u.autoZoom&&(M.autoZoom=u.autoZoom),t.add(M),T.cameras[s]=M,T.objects[s]=M,void 0!==u.userData)for(var g in u.userData){var v=u.userData[g];M.userData[g]=v}}else n=u.position,o=u.rotation,i=u.scale,r=u.quaternion,(c=new THREE.Object3D).name=s,c.position.fromArray(n),r?c.quaternion.fromArray(r):c.rotation.fromArray(o),c.scale.fromArray(i),c.visible=void 0!==u.visible&&u.visible,t.add(c),T.objects[s]=c,T.empties[s]=c;if(c){if(void 0!==u.userData)for(var g in u.userData){var v=u.userData[g];c.userData[g]=v}if(void 0!==u.groups)for(var b=0;b<u.groups.length;b++){var y=u.groups[b];void 0===T.groups[y]&&(T.groups[y]=[]),T.groups[y].push(s)}}}void 0!==c&&void 0!==u.children&&e(c,u.children)}}(T.scene,x.objects)}function f(e){for(A in e.parameters){var t;"envMap"!==A&&"map"!==A&&"lightMap"!==A&&"bumpMap"!==A&&"normalMap"!==A&&"specularMap"!==A&&"emissiveMap"!==A&&"alphaMap"!==A&&"roughnessMap"!==A&&"metalnessMap"!==A&&"aoMap"!==A||null!=(t=e.parameters[A])&&-1==d.indexOf(t)&&d.push(t)}}function g(n){return function(e,t){var a;e.name=n,a=e,e=t,t=n,T.geometries[t]=a,T.face_materials[t]=e,h(),--i,R.onLoadComplete(),v()}}function C(t,a,n,o){return function(e){e=e.content||(e.dae?e.scene:e);(function(e,t,a,n,o){var i=o.position,r=o.rotation,s=o.quaternion,l=o.scale;e.position.fromArray(i),s?e.quaternion.fromArray(s):e.rotation.fromArray(r),e.scale.fromArray(l),n&&e.traverse(function(e){e.material=n});var c=void 0===o.visible||o.visible;e.traverse(function(e){e.visible=c}),a.add(e),e.name=t,T.objects[t]=e,h()})(e,t,a,n,o),--i,R.onLoadComplete(),v()}}function v(e){var t={totalModels:r,totalTextures:s,loadedModels:r-i,loadedTextures:s-o};R.callbackProgress(t,T),R.onLoadProgress(),0===i&&0===o&&(function(){for(var e=0;e<c.length;e++){var t=c[e],a=T.objects[t.targetName];a?t.object.target=a:(t.object.target=new THREE.Object3D,T.scene.add(t.object.target)),t.object.target.userData.targetInverse=t.object}}(),a(T),e&&e(T))}o=i=0,T={scene:new THREE.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},this.result=T,x.transform&&(t=x.transform.position||[0,0,0],l=x.transform.rotation||[0,0,0],e=x.transform.scale||[1,1,1],t&&T.scene.position.fromArray(t),l&&T.scene.rotation.fromArray(l),e&&T.scene.scale.fromArray(e),(t||l||e)&&(T.scene.updateMatrix(),T.scene.updateMatrixWorld()));function b(e,t){return function(){o-=e,v(t),R.onLoadComplete()}}var y,S,H,I,O,D,k,L,P,A;for(y in x.fogs)"linear"===(S=x.fogs[y]).type?n=new THREE.Fog(0,S.near,S.far):"exp2"===S.type&&(n=new THREE.FogExp2(0,S.density)),S=S.color,n.color.setRGB(S[0],S[1],S[2]),T.fogs[y]=n;for(H in x.geometries)(D=x.geometries[H]).type in this.geometryHandlers&&(i+=1,R.onLoadStart());for(I in x.objects)!function e(t,a){if(a(t),void 0!==t.children)for(var n in t.children)e(t.children[n],a)}(x.objects[I],function(e){e.type&&e.type in R.hierarchyHandlers&&(i+=1,R.onLoadStart())});for(H in r=i,x.geometries)"cube"===(D=x.geometries[H]).type?((E=new THREE.BoxBufferGeometry(D.width,D.height,D.depth,D.widthSegments,D.heightSegments,D.depthSegments)).name=H,T.geometries[H]=E):"plane"===D.type?((E=new THREE.PlaneBufferGeometry(D.width,D.height,D.widthSegments,D.heightSegments)).name=H,T.geometries[H]=E):"sphere"===D.type?((E=new THREE.SphereBufferGeometry(D.radius,D.widthSegments,D.heightSegments)).name=H,T.geometries[H]=E):"cylinder"===D.type?((E=new THREE.CylinderBufferGeometry(D.topRad,D.botRad,D.height,D.radSegs,D.heightSegs)).name=H,T.geometries[H]=E):"torus"===D.type?((E=new THREE.TorusBufferGeometry(D.radius,D.tube,D.segmentsR,D.segmentsT)).name=H,T.geometries[H]=E):"icosahedron"===D.type?((E=new THREE.IcosahedronGeometry(D.radius,D.subdivisions)).name=H,T.geometries[H]=E):D.type in this.geometryHandlers?this.geometryHandlers[D.type].loaderObject.load(R.get_url(D.url,x.urlBaseType),g(H)):"embedded"===D.type&&((O=x.embeds[D.id]).metadata=x.metadata,O&&function(a){return function(e,t){e.name=a,T.geometries[a]=e,T.face_materials[a]=t}}(H)((O=this.geometryHandlers.ascii.loaderObject.parse(O,"")).geometry,O.materials));for(k in this.byRequest&&!function e(t){for(var a in t){var n=t[a];if(n.material){if("MeshFaceMaterial"===x.materials[n.material].type)for(var o=0,i=x.materials[n.material].parameters.materials.length;o<i;o++)-1==u.indexOf(x.materials[n.material].parameters.materials[o])&&(u.push(x.materials[n.material].parameters.materials[o]),f(x.materials[x.materials[n.material].parameters.materials[o]]));if("MultiMaterial"===x.materials[n.material].type)for(o=0,i=x.materials[n.material].parameters.materials.length;o<i;o++)-1==u.indexOf(x.materials[n.material].parameters.materials[o])&&(u.push(x.materials[n.material].parameters.materials[o]),f(x.materials[x.materials[n.material].parameters.materials[o]]));-1==u.indexOf(n.material)&&(u.push(n.material),f(x.materials[n.material]))}void 0!==n.children&&e(n.children)}}(x.objects),x.textures)this.byRequest&&-1==d.indexOf(k)||function(e){if(!T.textures[e])if(L=x.textures[e],Array.isArray(L.url)){o+=L.url.length;for(var t=0;t<L.url.length;t++)R.onLoadStart()}else o+=1,R.onLoadStart()}(k);for(k in s=o,x.textures)this.byRequest&&-1==d.indexOf(k)||R.addTexture(k,void 0,b);for(P in x.materials)this.byRequest&&-1==u.indexOf(P)||R.addMaterial(P);for(P in x.materials)this.byRequest&&-1==u.indexOf(P)||R.addFaceMaterial(P);h(),T.cameras&&x.defaults.camera&&(T.currentCamera=T.cameras[x.defaults.camera]),T.fogs&&x.defaults.fog&&(T.scene.fog=T.fogs[x.defaults.fog]),R.callbackSync(T),v()},newMaterial:function(e,t){function a(e,t){t=t,e={totalTextures:i,loadedTextures:i-(o-=e)},console.log("total_textures",i),console.log("counter_textures",o),r.callbackProgress(e,r.result),0===o&&(console.log("counter_textures_0"),t&&(console.log("onLoad_onLoad"),t()))}var o=0,i=0,r=this,s=function(e,t){return function(){a(e,t)}};if(this.result.materials[e])t();else{var n=this.data.materials[e];if(n.parameters.materials){console.log("mat",n.parameters.materials);for(var l=0,c=n.parameters.materials.length;l<c;l++)u(this.data.materials[n.parameters.materials[l]],t),r.addMaterial(n.parameters.materials[l]),console.log("addMaterial",n.parameters.materials[l]),console.log("addMaterial_applyTexture",this.data.materials);console.log("result_material"),r.addMaterial(e),r.addFaceMaterial(e)}else u(n,t),r.addMaterial(e)}function u(e,t){console.log("applyTexture");var a=function(e){var t,a=[];for(t in e.parameters){var n;"envMap"!==t&&"map"!==t&&"lightMap"!==t&&"bumpMap"!==t&&"normalMap"!==t&&"specularMap"!==t&&"emissiveMap"!==t&&"alphaMap"!==t&&"roughnessMap"!==t&&"metalnessMap"!==t&&"aoMap"!==t||(null==(n=e.parameters[t])||-1!=r.texturesInMaterials.indexOf(n)||-1!=a.indexOf(n)||n instanceof THREE.Texture||a.push(n))}return a}(e);if(0!=a.length){i+=a.length;for(var n=0;n<a.length;n++)!function(e){if(!r.result.textures[e]){var t=r.data.textures[e];if(Array.isArray(t.url)){o+=t.url.length;for(var a=0;a<t.url.length;a++)r.onLoadStart()}else o+=1,r.onLoadStart()}}(a[n]);for(n=0;n<a.length;n++)r.addTexture(a[n],t,s);console.log("total_textures",a)}}},addMaterial:function(e){var t=this;if(!t.result.materials[e]){var a,n,o=t.data.materials[e];for(a in o.parameters)"envMap"===a||"map"===a||"lightMap"===a||"bumpMap"===a||"normalMap"===a||"specularMap"===a||"emissiveMap"===a||"alphaMap"===a||"roughnessMap"===a||"metalnessMap"===a||"aoMap"===a?o.parameters[a]=t.result.textures[o.parameters[a]]:"flatShading"===a?(o.parameters[a]="true",o.parameters[a]=THREE.FlatShading):"side"===a?"double"==o.parameters[a]?o.parameters[a]=THREE.DoubleSide:"back"==o.parameters[a]?o.parameters[a]=THREE.BackSide:o.parameters[a]=THREE.FrontSide:"blending"===a?o.parameters[a]=o.parameters[a]in THREE?THREE[o.parameters[a]]:THREE.NormalBlending:"depthMode"===a?o.parameters[a]=o.parameters[a]in THREE?THREE[o.parameters[a]]:THREE.NeverDepth:"combine"===a?o.parameters[a]=o.parameters[a]in THREE?THREE[o.parameters[a]]:THREE.MultiplyOperation:"vertexColors"===a?"face"==o.parameters[a]?o.parameters[a]=THREE.FaceColors:o.parameters[a]&&(o.parameters[a]=THREE.VertexColors):"wrapRGB"===a?(n=o.parameters[a],o.parameters[a]=new THREE.Vector3(n[0],n[1],n[2])):"normalScale"===a&&(n=o.parameters[a],o.parameters[a]=new THREE.Vector2(n[0],n[1]));if(void 0!==o.parameters.opacity&&o.parameters.opacity<1&&(o.parameters.transparent=!0),o.parameters.side=THREE.DoubleSide,"MultiMaterial"==o.type){if(o.parameters.materials){for(var i=[],r=0;r<o.parameters.materials.length;r++){var s=o.parameters.materials[r];i.push(t.result.materials[s])}t.result.materials[e]=i}}else{var l=new THREE[o.type](o.parameters);l.name=e,t.result.materials[e]=l}}},addFaceMaterial:function(e){var t=this.data.materials[e];if(t.parameters.materials){for(var a=[],n=0;n<t.parameters.materials.length;n++){var o=t.parameters.materials[n];a.push(this.result.materials[o])}this.result.materials[e].materials=a}},addTexture:function(e,t,a){var n=this;if(!n.result.textures[e]){var o,i,r=n.data.textures[e];if(void 0!==r.mapping&&void 0!==THREE[r.mapping]&&(r.mapping=THREE[r.mapping]),Array.isArray(r.url)){for(var s=r.url.length,l=[],c=0;c<s;c++)l[c]=n.get_url(r.url[c],n.data.urlBaseType);null!==(u=THREE.Loader.Handlers.get(l[0]))?(o=u.load(l,a(s,t)),void 0!==r.mapping&&(o.mapping=r.mapping)):(o=(new THREE.CubeTextureLoader).load(l,a(s,t))).mapping=r.mapping}else{var u,d=n.get_url(r.url,n.data.urlBaseType),p=a(1,t);null!==(u=THREE.Loader.Handlers.get(d))?o=u.load(d,p):(o=new THREE.Texture,u=new THREE.ImageLoader,i=o,u.load(d,function(e){i.image=e,i.needsUpdate=!0,p()})),void 0!==r.mapping&&(o.mapping=r.mapping),void 0!==THREE[r.minFilter]&&(o.minFilter=THREE[r.minFilter]),void 0!==THREE[r.magFilter]&&(o.magFilter=THREE[r.magFilter]),void 0!==THREE[r.encoding]&&(o.encoding=THREE[r.encoding]),void 0!==THREE[r.format]&&(o.format=THREE[r.format]),r.anisotropy&&(o.anisotropy=r.anisotropy),r.rotation&&(o.rotation=r.rotation),void 0!==r.flipY&&(o.flipY=r.flipY),r.center&&o.center.set(r.center[0],r.center[1]),r.repeat&&(o.repeat.set(r.repeat[0],r.repeat[1]),1!==r.repeat[0]&&(o.wrapS=THREE.RepeatWrapping),1!==r.repeat[1]&&(o.wrapT=THREE.RepeatWrapping)),r.offset&&o.offset.set(r.offset[0],r.offset[1]),r.wrap&&(void 0!==(d={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping,clamp:THREE.ClampToEdgeWrapping})[r.wrap[0]]&&(o.wrapS=d[r.wrap[0]]),void 0!==d[r.wrap[1]]&&(o.wrapT=d[r.wrap[1]]))}n.result.textures[e]=o}},get_url:function(e,t){return"relativeToHTML"==t?e:this.urlBase+e}};var ION=ION||{};"object"==typeof module&&(module.exports=ION),ION.CompressionMethod={RAW:5718354,MG1:3229517,MG2:3295053},ION.Flags={NORMALS:1},ION.File=function(e){this.load(e)},ION.File.prototype.load=function(e){this.header=new ION.FileHeader(e),this.body=new ION.FileBody(this.header),this.getReader().read(e,this.body)},ION.File.prototype.getReader=function(){var e;switch(this.header.compressionMethod){case ION.CompressionMethod.RAW:e=new ION.ReaderRAW;break;case ION.CompressionMethod.MG1:e=new ION.ReaderMG1;break;case ION.CompressionMethod.MG2:e=new ION.ReaderMG2}return e},ION.FileHeader=function(e){e.readInt32(),this.fileFormat=e.readInt32(),this.compressionMethod=e.readInt32(),this.vertexCount=e.readInt32(),this.triangleCount=e.readInt32(),this.uvMapCount=e.readInt32(),this.attrMapCount=e.readInt32(),this.flags=e.readInt32(),this.comment=e.readString()},ION.FileHeader.prototype.hasNormals=function(){return this.flags&ION.Flags.NORMALS},ION.FileBody=function(e){var t=3*e.triangleCount,a=3*e.vertexCount,n=e.hasNormals()?3*e.vertexCount:0,o=2*e.vertexCount,i=4*e.vertexCount,r=0,s=new ArrayBuffer(4*(t+a+n+o*e.uvMapCount+i*e.attrMapCount));if(this.indices=new Uint32Array(s,0,t),this.vertices=new Float32Array(s,4*t,a),e.hasNormals()&&(this.normals=new Float32Array(s,4*(t+a),n)),e.uvMapCount)for(this.uvMaps=[],r=0;r<e.uvMapCount;++r)this.uvMaps[r]={uv:new Float32Array(s,4*(t+a+n+r*o),o)};if(e.attrMapCount)for(this.attrMaps=[],r=0;r<e.attrMapCount;++r)this.attrMaps[r]={attr:new Float32Array(s,4*(t+a+n+o*e.uvMapCount+r*i),i)}},ION.FileMG2Header=function(e){e.readInt32(),this.vertexPrecision=e.readFloat32(),this.normalPrecision=e.readFloat32(),this.lowerBoundx=e.readFloat32(),this.lowerBoundy=e.readFloat32(),this.lowerBoundz=e.readFloat32(),this.higherBoundx=e.readFloat32(),this.higherBoundy=e.readFloat32(),this.higherBoundz=e.readFloat32(),this.divx=e.readInt32(),this.divy=e.readInt32(),this.divz=e.readInt32(),this.sizex=(this.higherBoundx-this.lowerBoundx)/this.divx,this.sizey=(this.higherBoundy-this.lowerBoundy)/this.divy,this.sizez=(this.higherBoundz-this.lowerBoundz)/this.divz},ION.ReaderRAW=function(){},ION.ReaderRAW.prototype.read=function(e,t){this.readIndices(e,t.indices),this.readVertices(e,t.vertices),t.normals&&this.readNormals(e,t.normals),t.uvMaps&&this.readUVMaps(e,t.uvMaps),t.attrMaps&&this.readAttrMaps(e,t.attrMaps)},ION.ReaderRAW.prototype.readIndices=function(e,t){e.readInt32(),e.readArrayInt32(t)},ION.ReaderRAW.prototype.readVertices=function(e,t){e.readInt32(),e.readArrayFloat32(t)},ION.ReaderRAW.prototype.readNormals=function(e,t){e.readInt32(),e.readArrayFloat32(t)},ION.ReaderRAW.prototype.readUVMaps=function(e,t){for(var a=0;a<t.length;++a)e.readInt32(),t[a].name=e.readString(),t[a].filename=e.readString(),e.readArrayFloat32(t[a].uv)},ION.ReaderRAW.prototype.readAttrMaps=function(e,t){for(var a=0;a<t.length;++a)e.readInt32(),t[a].name=e.readString(),e.readArrayFloat32(t[a].attr)},ION.ReaderMG1=function(){},ION.ReaderMG1.prototype.read=function(e,t){this.readIndices(e,t.indices),this.readVertices(e,t.vertices),t.normals&&this.readNormals(e,t.normals),t.uvMaps&&this.readUVMaps(e,t.uvMaps),t.attrMaps&&this.readAttrMaps(e,t.attrMaps)},ION.ReaderMG1.prototype.readIndices=function(e,t){e.readInt32(),e.readInt32();var a=new ION.InterleavedStream(t,3);LZMA.decompress(e,e,a,a.data.length),ION.restoreIndices(t,t.length)},ION.ReaderMG1.prototype.readVertices=function(e,t){e.readInt32(),e.readInt32();t=new ION.InterleavedStream(t,1);LZMA.decompress(e,e,t,t.data.length)},ION.ReaderMG1.prototype.readNormals=function(e,t){e.readInt32(),e.readInt32();t=new ION.InterleavedStream(t,3);LZMA.decompress(e,e,t,t.data.length)},ION.ReaderMG1.prototype.readUVMaps=function(e,t){for(var a=0;a<t.length;++a){e.readInt32(),t[a].name=e.readString(),t[a].filename=e.readString(),e.readInt32();var n=new ION.InterleavedStream(t[a].uv,2);LZMA.decompress(e,e,n,n.data.length)}},ION.ReaderMG1.prototype.readAttrMaps=function(e,t){for(var a=0;a<t.length;++a){e.readInt32(),t[a].name=e.readString(),e.readInt32();var n=new ION.InterleavedStream(t[a].attr,4);LZMA.decompress(e,e,n,n.data.length)}},ION.ReaderMG2=function(){},ION.ReaderMG2.prototype.read=function(e,t){this.MG2Header=new ION.FileMG2Header(e),this.readVertices(e,t.vertices),this.readIndices(e,t.indices),t.normals&&this.readNormals(e,t),t.uvMaps&&this.readUVMaps(e,t.uvMaps),t.attrMaps&&this.readAttrMaps(e,t.attrMaps)},ION.ReaderMG2.prototype.readVertices=function(e,t){e.readInt32(),e.readInt32();var a=new ION.InterleavedStream(t,3);LZMA.decompress(e,e,a,a.data.length);e=this.readGridIndices(e,t);ION.restoreVertices(t,this.MG2Header,e,this.MG2Header.vertexPrecision)},ION.ReaderMG2.prototype.readGridIndices=function(e,t){e.readInt32(),e.readInt32();var a=new Uint32Array(t.length/3),t=new ION.InterleavedStream(a,1);return LZMA.decompress(e,e,t,t.data.length),ION.restoreGridIndices(a,a.length),a},ION.ReaderMG2.prototype.readIndices=function(e,t){e.readInt32(),e.readInt32();var a=new ION.InterleavedStream(t,3);LZMA.decompress(e,e,a,a.data.length),ION.restoreIndices(t,t.length)},ION.ReaderMG2.prototype.readNormals=function(e,t){e.readInt32(),e.readInt32();var a=new ION.InterleavedStream(t.normals,3);LZMA.decompress(e,e,a,a.data.length);a=ION.calcSmoothNormals(t.indices,t.vertices);ION.restoreNormals(t.normals,a,this.MG2Header.normalPrecision)},ION.ReaderMG2.prototype.readUVMaps=function(e,t){for(var a=0;a<t.length;++a){e.readInt32(),t[a].name=e.readString(),t[a].filename=e.readString();var n=e.readFloat32();e.readInt32();var o=new ION.InterleavedStream(t[a].uv,2);LZMA.decompress(e,e,o,o.data.length),ION.restoreMap(t[a].uv,2,n)}},ION.ReaderMG2.prototype.readAttrMaps=function(e,t){for(var a=0;a<t.length;++a){e.readInt32(),t[a].name=e.readString();var n=e.readFloat32();e.readInt32();var o=new ION.InterleavedStream(t[a].attr,4);LZMA.decompress(e,e,o,o.data.length),ION.restoreMap(t[a].attr,4,n)}},ION.restoreIndices=function(e,t){var a=3;for(0<t&&(e[2]+=e[0],e[1]+=e[0]);a<t;a+=3)e[a]+=e[a-3],e[a]===e[a-3]?e[a+1]+=e[a-2]:e[a+1]+=e[a],e[a+2]+=e[a]},ION.restoreGridIndices=function(e,t){for(var a=1;a<t;++a)e[a]+=e[a-1]},ION.restoreVertices=function(e,t,a,n){for(var o,i,r,s,l,c=new Uint32Array(e.buffer,e.byteOffset,e.length),u=t.divx,d=u*t.divy,p=2147483647,m=0,h=0,f=0,g=a.length;h<g;f+=3)r=o=a[h++],r-=~~((l=~~(r/d))*d),r-=~~((s=~~(r/u))*u),i=c[f],o===p&&(i+=m),e[f]=t.lowerBoundx+r*t.sizex+n*i,e[f+1]=t.lowerBoundy+s*t.sizey+n*c[f+1],e[f+2]=t.lowerBoundz+l*t.sizez+n*c[f+2],p=o,m=i},ION.restoreNormals=function(e,t,a){for(var n,o,i,r,s,l,c=new Uint32Array(e.buffer,e.byteOffset,e.length),u=0,d=e.length,p=1.5707963267948966;u<d;u+=3)r=c[u]*a,0===(l=c[u+1])?(e[u]=t[u]*r,e[u+1]=t[u+1]*r,e[u+2]=t[u+2]*r):(s=l<=4?(c[u+2]-2)*p:(4*c[u+2]/l-2)*p,l*=a*p,n=(i=r*Math.sin(l))*Math.cos(s),o=i*Math.sin(s),i=r*Math.cos(l),s=t[u+1],r=t[u]-t[u+2],1e-20<(l=Math.sqrt(2*s*s+r*r))&&(r/=l,s/=l),e[u]=t[u]*i+(t[u+1]*s-t[u+2]*r)*o-s*n,e[u+1]=t[u+1]*i-(t[u+2]+t[u])*s*o+r*n,e[u+2]=t[u+2]*i+(t[u]*r+t[u+1]*s)*o+s*n)},ION.restoreMap=function(e,t,a){for(var n,o,i,r=new Uint32Array(e.buffer,e.byteOffset,e.length),s=0,l=e.length;s<t;++s)for(n=0,i=s;i<l;i+=t)n+=1&(o=r[i])?-(o+1>>1):o>>1,e[i]=n*a},ION.calcSmoothNormals=function(e,t){for(var a,n,o,i,r,s,l,c,u,d,p,m=new Float32Array(t.length),h=0,f=e.length;h<f;)a=3*e[h++],n=3*e[h++],o=3*e[h++],r=t[n]-t[a],c=t[o]-t[a],s=t[1+n]-t[1+a],u=t[1+o]-t[1+a],l=t[2+n]-t[2+a],i=s*(d=t[2+o]-t[2+a])-l*u,d=l*c-r*d,c=r*u-s*c,1e-10<(p=Math.sqrt(i*i+d*d+c*c))&&(i/=p,d/=p,c/=p),m[a]+=i,m[1+a]+=d,m[2+a]+=c,m[n]+=i,m[1+n]+=d,m[2+n]+=c,m[o]+=i,m[1+o]+=d,m[2+o]+=c;for(h=0,f=m.length;h<f;h+=3)r=m[h],s=m[h+1],l=m[h+2],1e-10<(p=Math.sqrt(r*r+s*s+l*l))&&(m[h]=r/p,m[h+1]=s/p,m[h+2]=l/p);return m},ION.isLittleEndian=function(){var e=new ArrayBuffer(2),t=new Uint8Array(e),e=new Uint16Array(e);return(t[0]=1)===e[0]}(),ION.InterleavedStream=function(e,t){this.data=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.offset=ION.isLittleEndian?3:0,this.count=4*t,this.len=this.data.length},ION.InterleavedStream.prototype.writeByte=function(e){this.data[this.offset]=e,this.offset+=this.count,this.offset>=this.len&&(this.offset-=this.len-4,this.offset>=this.count&&(this.offset-=this.count+(ION.isLittleEndian?1:-1)))},ION.Stream=function(e){this.data=e,this.offset=0},ION.Stream.prototype.TWO_POW_MINUS23=Math.pow(2,-23),ION.Stream.prototype.TWO_POW_MINUS126=Math.pow(2,-126),ION.Stream.prototype.readByte=function(){return 255&this.data[this.offset++]},ION.Stream.prototype.readInt32=function(){var e=this.readByte();return e|=this.readByte()<<8,(e|=this.readByte()<<16)|this.readByte()<<24},ION.Stream.prototype.readFloat32=function(){var e=this.readByte();e+=this.readByte()<<8;var t=this.readByte(),a=this.readByte();e+=(127&t)<<16;t=(127&a)<<1|(128&t)>>>7,a=128&a?-1:1;return 255==t?0!==e?NaN:1/0*a:0<t?a*(1+e*this.TWO_POW_MINUS23)*Math.pow(2,t-127):0!==e?a*e*this.TWO_POW_MINUS126:0*a},ION.Stream.prototype.readString=function(){var e=this.readInt32();return this.offset+=e,String.fromCharCode.apply(null,this.data.subarray(this.offset-e,this.offset))},ION.Stream.prototype.readArrayInt32=function(e){for(var t=0,a=e.length;t<a;)e[t++]=this.readInt32();return e},ION.Stream.prototype.readArrayFloat32=function(e){for(var t=0,a=e.length;t<a;)e[t++]=this.readFloat32();return e},THREE.IONLoader=function(){THREE.Loader.call(this),Object.defineProperties(this,{statusDomElement:{get:function(){return void 0===this._statusDomElement&&(this._statusDomElement=document.createElement("div")),console.warn("THREE.BinaryLoader: .statusDomElement has been removed."),this._statusDomElement}}})},THREE.IONLoader.prototype=Object.create(THREE.Loader.prototype),THREE.IONLoader.prototype.constructor=THREE.IONLoader,THREE.IONLoader.prototype.loadParts=function(e,s,l){l=l||{};var c=this,u=new XMLHttpRequest,d=l.basePath||this.extractUrlBase(e);u.onreadystatechange=function(){if(4===u.readyState&&(200===u.status||0===u.status)){var t=JSON.parse(u.responseText),a=[],n=[],o=0;for(var e=0;e<t.materials.length;e++)a[e]=c.createMaterial(t.materials[e],d);var i=d+t.data,r={useWorker:l.useWorker,offsets:t.offsets};c.load(i,function(e){o+=1,n.push(e),o===t.offsets.length&&s(n,a)},r)}},u.open("GET",e,!0),u.setRequestHeader("Content-Type","text/plain"),u.send(null)},THREE.IONLoader.prototype.load=function(o,r,s){var l=this,c=void 0!==(s=s||{}).offsets?s.offsets:[0],u=new XMLHttpRequest;u.onreadystatechange=function(){if(4===u.readyState)if(200===u.status||0===u.status){var e=new Uint8Array(u.response),i=Date.now();if(s.useWorker){var t=s.worker||new Worker("js/loaders/ion/IONWorker.js");t.onmessage=function(e){for(var t=e.data,a=0;a<t.length;a++){var n=t[a],o=Date.now();console.log("ION data parse time [worker]: "+(o-i)+" ms"),l.createModel(n,r);n=Date.now();console.log("model load time [worker]: "+(n-o)+" ms, total: "+(n-i))}},t.postMessage({data:e,offsets:c})}else{for(var a=0;a<c.length;a++){var n=new ION.Stream(e);n.offset=c[a];n=new ION.File(n);l.createModel(n,r)}t=Date.now();console.log("ION data parse time [inline]: "+(t-i)+" ms")}}else console.error("Couldn't load ["+o+"] ["+u.status+"]");else 3===u.readyState||2===u.readyState&&u.getResponseHeader("Content-Length")},u.open("GET",o,!0),u.responseType="arraybuffer",u.send(null)},THREE.IONLoader.prototype.createModel=function(d,e){var t=function(){THREE.BufferGeometry.call(this),this.materials=[];var e,t,a,n=d.body.indices,o=d.body.vertices,i=d.body.normals,r=d.body.uvMaps;void 0!==r&&0<r.length&&(e=r[0].uv,1<r.length&&(t=r[1].uv));r=d.body.attrMaps;if(void 0!==r&&0<r.length&&"Color"===r[0].name&&(a=r[0].attr),this.setIndex(new THREE.BufferAttribute(n,1)),this.addAttribute("position",new THREE.BufferAttribute(o,3)),void 0!==i&&this.addAttribute("normal",new THREE.BufferAttribute(i,3)),e&&this.addAttribute("uv",new THREE.BufferAttribute(e,2)),t&&this.addAttribute("uv2",new THREE.BufferAttribute(t,2)),void 0!==a&&this.addAttribute("color",new THREE.BufferAttribute(a,4)),d.header.comment){var s=JSON.parse(d.header.comment);if(s&&s.r)for(var l=0;l<s.r.length;l++){var c=s.r[l],u=0;"mat_ID1"==c.m?u=0:"mat_ID2"==c.m?u=1:"mat_ID3"==c.m?u=2:"mat_ID4"==c.m?u=3:"mat_ID5"==c.m?u=4:"mat_ID6"==c.m?u=5:"mat_ID7"==c.m?u=6:"mat_ID8"==c.m?u=7:"mat_ID9"==c.m?u=8:"mat_ID10"==c.m?u=9:"mat_ID11"==c.m?u=10:"mat_ID12"==c.m?u=11:"mat_ID13"==c.m?u=12:"mat_ID14"==c.m?u=13:"mat_ID15"==c.m?u=14:"mat_ID16"==c.m?u=15:"mat_ID17"==c.m?u=16:"mat_ID18"==c.m?u=17:"mat_ID19"==c.m?u=18:"mat_ID20"==c.m?u=19:"mat_ID21"==c.m?u=20:"mat_ID22"==c.m?u=21:"mat_ID23"==c.m?u=22:"mat_ID24"==c.m?u=23:"mat_ID25"==c.m&&(u=24),this.addGroup(3*c.a,3*(c.b-c.a),u)}}},t=new((t.prototype=Object.create(THREE.BufferGeometry.prototype)).constructor=t);void 0===t.attributes.normal&&t.computeVertexNormals(),e(t)};var ZIP={MASK_BITS:[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],cplens:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cplext:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],cpdist:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cpdext:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],b:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],inflateBin:function(e,t,a){return new zip(e,t).inflateBin(a)},inflateStr:function(e,t){return new zip(e).inflateStr(t)},HuftNode:function(){this.e=0,this.b=0,this.n=0,this.t=null},HuftList:function(){this.next=null,this.list=null},HuftBuild:function(e,t,a,n,o,i){this.N_MAX=288,this.status=0,this.root=null,this.m=0;for(var r,s,l,c,u,d,p,m,h,f,g,v,b,y,E,w=new Array(17),M=new Array(17),_=new ZIP.HuftNode,T=new Array(16),R=new Array(this.N_MAX),x=new Array(17),C=this.root=null,S=0;S<w.length;S++)w[S]=0;for(S=0;S<M.length;S++)M[S]=0;for(S=0;S<T.length;S++)T[S]=null;for(S=0;S<R.length;S++)R[S]=0;for(S=0;S<x.length;S++)x[S]=0;for(s=256<t?e[256]:16,m=e,h=0,S=t;w[m[h]]++,h++,0<--S;);if(w[0]==t)return this.root=null,this.m=0,void(this.status=0);for(d=1;d<=16&&0==w[d];d++);for(i<(p=d)&&(i=d),S=16;0!=S&&0==w[S];S--);for((c=S)<i&&(i=S),b=1<<d;d<S;d++,b<<=1)if((b-=w[d])<0)return this.status=2,void(this.m=i);if((b-=w[S])<0)return this.status=2,void(this.m=i);for(w[S]+=b,x[1]=d=0,m=w,h=1,v=2;0<--S;)x[v++]=d+=m[h++];for(m=e,h=0,S=0;0!=(d=m[h++])&&(R[x[d]++]=S),++S<t;);for(t=x[c],m=R,u=-1,f=null,y=g=M[h=x[0]=S=0]=0;p<=c;p++)for(r=w[p];0<r--;){for(;p>g+M[1+u];){if(g+=M[1+u],u++,y=(y=c-g)>i?i:y,(l=1<<(d=p-g))>r+1)for(l-=r+1,v=p;++d<y&&!((l<<=1)<=w[++v]);)l-=w[v];for(s<g+d&&g<s&&(d=s-g),y=1<<d,M[1+u]=d,f=new Array(y),E=0;E<y;E++)f[E]=new ZIP.HuftNode;(C=null==C?this.root=new ZIP.HuftList:C.next=new ZIP.HuftList).next=null,C.list=f,T[u]=f,0<u&&(x[u]=S,_.b=M[u],_.e=16+d,_.t=f,d=(S&(1<<g)-1)>>g-M[u],T[u-1][d].e=_.e,T[u-1][d].b=_.b,T[u-1][d].n=_.n,T[u-1][d].t=_.t)}for(_.b=p-g,t<=h?_.e=99:m[h]<a?(_.e=m[h]<256?16:15,_.n=m[h++]):(_.e=o[m[h]-a],_.n=n[m[h++]-a]),l=1<<p-g,d=S>>g;d<y;d+=l)f[d].e=_.e,f[d].b=_.b,f[d].n=_.n,f[d].t=_.t;for(d=1<<p-1;0!=(S&d);d>>=1)S^=d;for(S^=d;(S&(1<<g)-1)!=x[u];)g-=M[u],u--}this.m=M[1],this.status=0!=b&&1!=c?1:0}};function zip(e,t){this.WSIZE=32768,this.LBITS=9,this.DBITS=6,this.slide=new Uint8Array(2*this.WSIZE),this.wp=0,this.bitBuf=0,this.bitLen=0,this.method=-1,this.eof=!1,this.copyLen=this.zip_copy_dist=0,this.tl=null,this.pos=0,this.offset=t,this.src=e,this.srcLength=e.byteLength,this.STORED_BLOCK=0,this.fixedTL=null,this.MASK_BITS=ZIP.MASK_BITS}zip.prototype.getByte=function(){return this.src[this.pos+++this.offset]},zip.prototype.needBits=function(e){for(;this.bitLen<e;)this.bitBuf|=this.getByte()<<this.bitLen,this.bitLen+=8},zip.prototype.getBits=function(e){return this.bitBuf&this.MASK_BITS[e]},zip.prototype.ngb=function(e){for(;this.bitLen<e;)this.bitBuf|=this.getByte()<<this.bitLen,this.bitLen+=8;return this.bitBuf&ZIP.MASK_BITS[e]},zip.prototype.dumpBits=function(e){this.bitBuf>>=e,this.bitLen-=e},zip.prototype.inflateCodes=function(e,t,a){var n,o,i=0;if(0==a)return 0;for(;;){for(n=(o=this.tl.list[this.ngb(this.zip_bl)]).e;16<n;){if(99==n)return-1;this.dumpBits(o.b),n=(o=o.t[this.ngb(n-16)]).e}if(this.dumpBits(o.b),16!=n){if(15==n)break;for(this.copyLen=o.n+this.ngb(n),this.dumpBits(n),n=(o=this.zip_td.list[this.ngb(this.zip_bd)]).e;16<n;){if(99==n)return-1;this.dumpBits(o.b),n=(o=o.t[this.ngb(n-16)]).e}for(this.dumpBits(o.b),this.zip_copy_dist=this.wp-o.n-this.ngb(n),this.dumpBits(n);0<this.copyLen&&i<a;)this.copyLen--,this.zip_copy_dist&=32767,this.wp&=32767,e[t+i++]=this.slide[this.wp++]=this.slide[this.zip_copy_dist++];if(i==a)return a}else if(this.wp&=32767,e[t+i++]=this.slide[this.wp++]=o.n,i==a)return a}return this.method=-1,i},zip.prototype.inflateStored=function(e,t,a){var n=7&this.bitLen;if(this.dumpBits(n),n=this.ngb(16),this.dumpBits(16),this.needBits(16),n!=(65535&~this.bitBuf))return-1;for(this.dumpBits(16),this.copyLen=n,n=0;0<this.copyLen&&n<a;)this.copyLen--,this.wp&=32767,e[t+n++]=this.slide[this.wp++]=this.ngb(8),this.dumpBits(8);return 0==this.copyLen&&(this.method=-1),n},zip.prototype.inflateFixed=function(e,t,a){if(null==this.fixedTL){for(var n,o=new Array(288),i=0;i<144;i++)o[i]=8;for(;i<256;i++)o[i]=9;for(;i<280;i++)o[i]=7;for(;i<288;i++)o[i]=8;if(this.zip_fixed_bl=7,0!=(n=new ZIP.HuftBuild(o,288,257,ZIP.cplens,ZIP.cplext,this.zip_fixed_bl)).status)return alert("HufBuild error: "+n.status),-1;for(this.fixedTL=n.root,this.zip_fixed_bl=n.m,i=0;i<30;i++)o[i]=5;if(this.zip_fixed_bd=5,1<(n=new ZIP.HuftBuild(o,30,0,ZIP.cpdist,ZIP.cpdext,this.zip_fixed_bd)).status)return this.fixedTL=null,alert("HufBuild error: "+n.status),-1;this.zip_fixed_td=n.root,this.zip_fixed_bd=n.m}return this.tl=this.fixedTL,this.zip_td=this.zip_fixed_td,this.zip_bl=this.zip_fixed_bl,this.zip_bd=this.zip_fixed_bd,this.inflateCodes(e,t,a)},zip.prototype.inflateDynamic=function(e,t,a){for(var n,o,i,r,s,l,c,u,d=new Array(316),p=0;p<d.length;p++)d[p]=0;if(l=257+this.ngb(5),this.dumpBits(5),c=1+this.ngb(5),this.dumpBits(5),s=4+this.ngb(4),this.dumpBits(4),286<l||30<c)return-1;for(n=0;n<s;n++)d[ZIP.b[n]]=this.ngb(3),this.dumpBits(3);for(;n<19;n++)d[ZIP.b[n]]=0;if(this.zip_bl=7,0!=(u=new ZIP.HuftBuild(d,19,19,null,null,this.zip_bl)).status)return-1;for(this.tl=u.root,this.zip_bl=u.m,i=l+c,p=o=0;p<i;)if(n=(r=this.tl.list[this.ngb(this.zip_bl)]).b,this.dumpBits(n),(n=r.n)<16)d[p++]=o=n;else if(16==n){if(n=3+this.ngb(2),this.dumpBits(2),i<p+n)return-1;for(;0<n--;)d[p++]=o}else if(17==n){if(n=3+this.ngb(3),this.dumpBits(3),i<p+n)return-1;for(;0<n--;)d[p++]=0;o=0}else{if(n=11+this.ngb(7),this.dumpBits(7),i<p+n)return-1;for(;0<n--;)d[p++]=0;o=0}if(this.zip_bl=this.LBITS,u=new ZIP.HuftBuild(d,l,257,ZIP.cplens,ZIP.cplext,this.zip_bl),0==this.zip_bl&&(u.status=1),0!=u.status)return u.status,-1;for(this.tl=u.root,this.zip_bl=u.m,p=0;p<c;p++)d[p]=d[p+l];return this.zip_bd=this.DBITS,u=new ZIP.HuftBuild(d,c,0,ZIP.cpdist,ZIP.cpdext,this.zip_bd),this.zip_td=u.root,this.zip_bd=u.m,0==this.zip_bd&&257<l?-1:(u.status,0!=u.status?-1:this.inflateCodes(e,t,a))},zip.prototype.inflateInternal=function(e,t,a){for(var n,o=0;o<a;){if(this.eof&&-1==this.method)return o;if(0<this.copyLen){if(this.method!=this.STORED_BLOCK)for(;0<this.copyLen&&o<a;)this.copyLen--,this.zip_copy_dist&=32767,this.wp&=32767,e[t+o++]=this.slide[this.wp++]=this.slide[this.zip_copy_dist++];else{for(;0<this.copyLen&&o<a;)this.copyLen--,this.wp&=32767,e[t+o++]=this.slide[this.wp++]=this.ngb(8),this.dumpBits(8);0==this.copyLen&&(this.method=-1)}if(o==a)return o}if(-1==this.method){if(this.eof)break;0!=this.ngb(1)&&(this.eof=!0),this.dumpBits(1),this.method=this.ngb(2),this.dumpBits(2),this.tl=null,this.copyLen=0}switch(this.method){case 0:n=this.inflateStored(e,t+o,a-o);break;case 1:n=null!=this.tl?this.inflateCodes(e,t+o,a-o):this.inflateFixed(e,t+o,a-o);break;case 2:n=null!=this.tl?this.inflateCodes(e,t+o,a-o):this.inflateDynamic(e,t+o,a-o);break;default:n=-1}if(-1==n)return this.eof?0:-1;o+=n}return o},zip.prototype.inflateBin=function(e){for(var t=-1,a=new Uint8Array(e);0<this.inflateInternal(a,0,e)&&t!=this.pos;)t=this.pos,0;return a};var LZMA=LZMA||{};function $g(e){return document.getElementById(e)}function $c(e){return document.createElement(e)}function extend(a){return Array.prototype.slice.call(arguments,1).forEach(function(e){if(e){for(var t in e)!e[t]||e[t].constructor!==Object||a[t]&&a[t].constructor!==Object?a[t]=e[t]:(a[t]=a[t]||{},extend(a[t],e[t]));"object"!=typeof e&&(a=e)}}),a}function easeInSine(e,t,a,n){return-a*Math.cos(e/n*(Math.PI/2))+a+t}function easeOutSine(e,t,a,n){return a*Math.sin(e/n*(Math.PI/2))+t}function easeInOutSine(e,t,a,n){return-a/2*(Math.cos(Math.PI*e/n)-1)+t}function easeInCirc(e,t,a,n){return-a*(Math.sqrt(1-(e/=n)*e)-1)+t}function easeOutCirc(e,t,a,n){return a*Math.sqrt(1-(e=e/n-1)*e)+t}function easeInOutCirc(e,t,a,n){return(e/=n/2)<1?-a/2*(Math.sqrt(1-e*e)-1)+t:a/2*(Math.sqrt(1-(e-=2)*e)+1)+t}function easeInBack(e,t,a,n,o){return a*(e/=n)*e*(2.70158*e-1.70158)+t}function easeOutBack(e,t,a,n,o){return a*((e=e/n-1)*e*(1.3*e+.3)+1)+t}function easeInOutBack(e,t,a,n,o){o=.6;return(e/=n/2)<1?a/2*(e*e*((1+(o*=1.2))*e-o))+t:a/2*((e-=2)*e*((1+(o*=1.2))*e+o)+2)+t}function easeInQuad(e,t,a,n){return a*(e/=n)*e+t}function easeOutQuad(e,t,a,n){return-a*(e/=n)*(e-2)+t}function easeInOutQuad(e,t,a,n){return(e/=n/2)<1?a/2*e*e+t:-a/2*(--e*(e-2)-1)+t}function easeInCubic(e,t,a,n){return a*(e/=n)*e*e+t}function easeOutCubic(e,t,a,n){return a*((e=e/n-1)*e*e+1)+t}function easeInOutCubic(e,t,a,n){return(e/=n/2)<1?a/2*e*e*e+t:a/2*((e-=2)*e*e+2)+t}function easeInQuart(e,t,a,n){return a*(e/=n)*e*e*e+t}function easeOutQuart(e,t,a,n){return-a*((e=e/n-1)*e*e*e-1)+t}function easeInOutQuart(e,t,a,n){return(e/=n/2)<1?a/2*e*e*e*e+t:-a/2*((e-=2)*e*e*e-2)+t}function easeInQuint(e,t,a,n){return a*(e/=n)*e*e*e*e+t}function easeOutQuint(e,t,a,n){return a*((e=e/n-1)*e*e*e*e+1)+t}function easeInOutQuint(e,t,a,n){return(e/=n/2)<1?a/2*e*e*e*e*e+t:a/2*((e-=2)*e*e*e*e+2)+t}function easeInExpo(e,t,a,n){return 0==e?t:a*Math.pow(2,10*(e/n-1))+t}function easeOutExpo(e,t,a,n){return e==n?t+a:a*(1-Math.pow(2,-10*e/n))+t}function easeInOutExpo(e,t,a,n){return 0==e?t:e==n?t+a:(e/=n/2)<1?a/2*Math.pow(2,10*(e-1))+t:a/2*(2-Math.pow(2,-10*--e))+t}function easeInElastic(e,t,a,n){var o=1.70158,i=0,r=a;return 0==e?t:1==(e/=n)?t+a:(i=i||.3*n,o=r<Math.abs(a)?(r=a,i/4):i/(2*Math.PI)*Math.asin(a/r),-(r*Math.pow(2,10*--e)*Math.sin((e*n-o)*(2*Math.PI)/i))+t)}function easeOutElastic(e,t,a,n){var o=1.70158,i=0,r=a;return 0==e?t:1==(e/=n)?t+a:(i=i||.3*n,o=r<Math.abs(a)?(r=a,i/4):i/(2*Math.PI)*Math.asin(a/r),r*Math.pow(2,-10*e)*Math.sin((e*n-o)*(2*Math.PI)/i)+a+t)}function easeInOutElastic(e,t,a,n){var o=1,i=0,r=a;return 0==e?t:2==(e/=n/2)?t+a:(i=i||n*(.3*1.5),o=r<Math.abs(a)?(r=a,i/4):i/(2*Math.PI)*Math.asin(a/r),e<1?r*Math.pow(2,10*--e)*Math.sin((e*n-o)*(2*Math.PI)/i)*-.5+t:r*Math.pow(2,-10*--e)*Math.sin((e*n-o)*(2*Math.PI)/i)*.5+a+t)}function easeInBounce(e,t,a,n){return a-easeOutBounce(n-e,0,a,n)+t}function easeOutBounce(e,t,a,n){return(e/=n)<1/2.75?a*(7.5625*e*e)+t:e<2/2.75?a*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?a*(7.5625*(e-=2.25/2.75)*e+.9375)+t:a*(7.5625*(e-=2.625/2.75)*e+.984375)+t}function easeInOutBounce(e,t,a,n){return e<n/2?.5*easeInBounce(2*e,0,a,n)+t:.5*easeOutBounce(2*e-n,0,a,n)+.5*a+t}function contains(e,t){return-1!==e.indexOf(t)}function any(e){return 0<Object.keys(e).length}function first(e){var t=Object.keys(e)[0];return t?e[t]:null}function round(e,t){return Math.ceil(e*t)/t}function rounVector(e,t){return new THREE.Vector3(round(e.x,t),round(e.y,t),round(e.z,t))}function getCurve(e){return null===e?e:window[e]}function getDiffArgument(e,t){if(-1<e.indexOf(".")){var a=e.split(".");if(2==a.length)return t[a[0]][a[1]];if(3==a.length)return t[a[0]][a[1]][a[2]];if(4==a.length)return t[a[0]][a[1]][a[2]][a[3]];if(5==a.length)return t[a[0]][a[1]][a[2]][a[3]][a[4]]}return t[e]}function orientation(e){function t(e){var t=e/90;t<0&&(t+=4);var a="rotate("+e+"deg)",t="progid:DXImageTransform.Microsoft.BasicImage(rotation="+t+")",t=["transform: "+a,"-webkit-transform: "+a,"-moz-transform: "+a,"-o-transform: "+a,"filter: "+t,"-ms-filter: "+t].join(";");document.body.setAttribute("style",t),window.rotation=e}window.innerHeight>window.innerWidth?window.rotation&&0!=window.rotation||t(90):90==window.rotation&&t(0)}function IonVR(e){e=e||{};this.data={param:{wind:{direction:350,speed:30},gust:{direction:270,speed:25},sun:{distance:400,inclination:.5,azimuth:.55,intensity:1.5},sky:{turbidity:10,rayleigh:2,luminance:1,mieCoefficient:.005,mieDirectionalG:.8,res:2048},live_data:{current:{cloud:0,feelslike_c:-2.9,feelslike_f:26.7,gust_kph:15.8,gust_mph:9.8,humidity:55,is_day:1,last_updated:"1999-01-09 10:40",last_updated_epoch:null,precip_in:0,precip_mm:0,pressure_in:30.4,pressure_mb:1013,temp_c:1,temp_f:33.8,uv:2,vis_km:14,vis_miles:8,wind_degree:180,wind_dir:"NW",wind_kph:50,wind_mph:6.9}},live_astro:{astronomy:{astro:{moon_illumination:63,moon_phase:"First Quarter",moonrise:"01:40 PM",moonset:"02:21 AM",sunrise:"07:50 AM",sunset:"04:45 PM"}}},animation:!0,wind_factor:2.4,sway_factor:.3,swiv_factor:1,months:{1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"Novermber",12:"December"},mMat:0,cMat:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0}}},this.data_stored={param:{wind:{direction:350,speed:30},gust:{direction:270,speed:25},sun:{distance:400,inclination:.5,azimuth:.55,intensity:1.5},sky:{turbidity:10,rayleigh:2,luminance:1,mieCoefficient:.005,mieDirectionalG:.8,res:2048},live_data:{current:{cloud:0,feelslike_c:-2.9,feelslike_f:26.7,gust_kph:15.8,gust_mph:9.8,humidity:55,is_day:1,last_updated:"1999-01-09 10:40",last_updated_epoch:null,precip_in:0,precip_mm:0,pressure_in:30.4,pressure_mb:1013,temp_c:1,temp_f:33.8,uv:2,vis_km:14,vis_miles:8,wind_degree:180,wind_dir:"NW",wind_kph:50,wind_mph:6.9}},live_astro:{astronomy:{astro:{moon_illumination:63,moon_phase:"First Quarter",moonrise:"01:40 PM",moonset:"02:21 AM",sunrise:"07:50 AM",sunset:"04:45 PM"}}},animation:!0,wind_factor:.4,sway_factor:.4,swiv_factor:.4,months:{1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"Novermber",12:"December"},mMat:0,cMat:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0}}},this.options=extend({},{stats:!1,debug:!1,container:null,skybox:!1,sky:!1,lightprobe:!0,lightprobe_tx:"",lightprobe_comp:"",lightprobeInt:.8,exposure:1.5,skybox_tx:"env_tex",always_render:!1,scene:"",env:"",scene_assets_url:"",woo_tex_url:"",woo_3d_url:"",geom_buffer:!1,camera:{position:{x:0,y:0,z:100},fov:35,target:{x:0,y:0,z:0}},g_in:!1,g_out:!1,g_f:2,phys_shading:!1,rotate_left:1.57,spin:!0,spin_duration:1e3,zoom_factor:10,set:null,ready:!1,showStatus:!0,audio:!1,audio_track:null},e),this.animations={},this.autorotations={},this.interfaces=[],this.clock=new THREE.Clock,this.loader=new THREE.SceneLoader,this.loader.byRequest=!0,this.cameraAnimations={},this.preloader=this.options.preloader,Detector.webgl?this.init():Detector.addGetWebGLMessage()}LZMA.decompress=function(e,t,a,n){var o=new zip(t.data,t.offset),i=o.inflateBin(n);t.offset+=o.pos+4;for(var r=0;r<n;r++)a.writeByte(i[r])},THREE.OrbitControls.prototype.focus=function(e,t,a){var o=this,n=o.target.clone(),i=o.object.position.clone(),r=o.object.fov,s=o.object.quaternion,arguments={};function l(e,t,a,n){e&&(o.object.quaternion=new THREE.Quaternion(e.x,e.y,e.z,e.w)),t&&o.object.position.copy(new THREE.Vector3(t.x,t.y,t.z)),a&&(o.object.fov=a,o.object.updateProjectionMatrix()),n&&(o.target=new THREE.Vector3(n.x,n.y,n.z),o.update())}e.position&&(arguments.position={obj:i,end:e.position}),e.target&&(arguments.center={obj:n,end:e.target}),e.fov&&(arguments.fov={obj:r,end:e.fov}),e.quaternion&&(arguments.quaternion={obj:s,end:e.quaternion}),this.enableRotate=!1,this.enablePan=!1,null==e.easing?t("focus",arguments,void 0,function(){o.enableRotate=!0,o.enablePan=!0,a(),l(e.quaternion,e.position,e.fov,e.target)}):t("focus",arguments,function(e){var t=e.center?e.center.obj:void 0,a=e.position?e.position.obj:void 0,n=e.fov?e.fov.obj:void 0;l(e.quaternion?e.quaternion.obj:void 0,a,n,t)},function(){o.enableRotate=!0,o.enablePan=!0,e.fov&&o.object.fov!=e.fov&&(o.object.fov=e.fov,o.object.updateProjectionMatrix()),a()})},THREE.OrbitControls.prototype.focus2=function(a,e,t){var n=this,arguments={};a.position&&(arguments.position={obj:a.position,end:a.position}),a.quaternion&&(arguments.quaternion={obj:a.quaternion,end:a.quaternion}),e("focus",arguments,function(e){var t=e.quaternion?e.quaternion.start:void 0,e=e.position?e.position.start:void 0;e&&n.object.position.copy(new THREE.Vector3(e.x,e.y,e.z));t&&(new THREE.Quaternion(+t.x,+t.y,+t.z,+t.w),n.object.position.clone(),t=a.t_position,n.target.copy(t),n.update(),console.log("camera",n.object.position,"t_vect",t))},function(){t()})},THREE.InterfaceFrame=function(s,e){var i,l=this,t=.11,c=e.style;function r(){var e;null!=l.renderer&&(i?(e=d(),l.camera.aspect=e.width/e.height,l.camera.updateProjectionMatrix(),l.camera.position.z=45/u(),l.renderer.setSize(e.width,e.height)):function(){var e=c.width||s.container.offsetWidth/3,t=c.height||s.container.offsetHeight/3;l.camera.aspect=e/t,l.camera.updateProjectionMatrix(),l.camera.position.z=45/u(),l.renderer.setSize(e,t);var a,n=s.container.offsetTop,o=s.container.offsetLeft,i=s.container.offsetWidth,r=s.container.offsetHeight,e=n/window.innerHeight*100,t=o/window.innerWidth*100,r=(window.innerHeight-(n+r))/window.innerHeight*100,i=(window.innerWidth-(o+i))/window.innerWidth*100;for(a in c)l.container.style[a]=c[a];l.container.style.top=c.top?c.top+e+"%":"",l.container.style.left=c.left?c.left+t+"%":"",l.container.style.right=c.right?c.right+i+"%":"",l.container.style.bottom=c.bottom?c.bottom+r+"%":""}())}function u(){var e=t/(45/d().width);return(1-e)/2*e+e}function d(){return{width:i?i.offsetWidth:c.width||s.container.offsetWidth/3,height:i?i.offsetHeight:c.height||s.container.offsetHeight/3}}return e.domElementId&&(i=$g(e.domElementId)),function(){var e=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1e3);e.position.z=45/u(),e.position.y=0,e.position.x=0,e.target=new THREE.Vector3;var t=new THREE.Scene;t.add(e);var a=new THREE.AmbientLight(16777215);t.add(a);var n=new THREE.WebGLRenderer({antialias:!0,alpha:!0});n.setPixelRatio(window.devicePixelRatio);var o,a=d();n.setSize(a.width,a.height),n.gammaInput=!0,n.gammaOutput=!0,i?o=i:(o=$c("div"),document.body.insertBefore(o,document.getElementById("toggle"))),o.appendChild(n.domElement),l.container=o,l.camera=e,l.scene=t,l.renderer=n,window.addEventListener("resize",r,!1)}(),r(),this},THREE.AnimationsHelper=function(h,s){var i=h.container,r=h.scene,f=h.camera,l=h.orbit_controls,e=[],g=[],v=[],b={};this.dispose=function(){for(var e=h.interfaces,t=["click","touchstart","mousemove"],a=0,n=e.length;a<n;a++){var o=e[a];t.map(function(e){u(o.container,e)})}t.map(function(e){u(i,e)}),u(l,"change")};var c={};function t(e,t,a,n){e in c||(c[e]={}),t in c[e]||(c[e][t]=[]),c[e][t].push([a,n]),e.addEventListener(t,a,n)}function u(e,t){if(e in c){var a=c[e];if(t in a)for(var n=a[t],o=n.length;o--;){var i=n[o];e.removeEventListener(t,i[0],i[1])}}}o(r,e);for(var d=h.interfaces,a=0,n=d.length;a<n;a++)(E=d[a]).objects=[],o(E.scene,E.objects),t(E.container,"click",R.bind(this,E),!1),t(E.container,"touchstart",x.bind(this,E),!1),t(E.container,"mousemove",C.bind(this,E),!1);function o(r,s){!function e(t,a){for(var n=0,o=t.length;n<o;n++){var i=t[n];0<i.children.length&&e(i.children),i.userData.animations&&(function(e){var t=i.userData.animations.click;if(t)for(var a=0;a<t.length;a++)t[a].event_id&&(b[t[a].event_id]||(b[t[a].event_id]=[]),b[t[a].event_id].push(e.getObjectByProperty("name",t[a].object,!0)))}(r),s.push(i),i.objectsLink=s),i.userData.lookat_camera&&(i.lookAtCamera=!0,v.push(i),i.lookAt(f.position)),i.userData.autorotation&&(h.autorotations[i.uuid]=i)}}(r.children)}var p=new THREE.Raycaster,m=new THREE.Vector2;function y(e,t,a){return m.set(2*e.x-1,-2*e.y+1),p.setFromCamera(m,a),p.intersectObjects(t)}var E,w=new THREE.Vector2,M=new THREE.Vector2;function _(e,t,a){e=e.getBoundingClientRect();return[(t-e.left)/e.width,(a-e.top)/e.height]}function T(e,t){e=y(w,e,t);0<e.length&&((t=e[0].object).userData.animations.click&&!I(t)&&(S(t,"click",0),(e=t).userData.animations.reverse?e.userData.animations.reverse=!e.userData.animations.reverse:e.userData.animations.reverse=!0),t.userData.animations.singleClick&&!I(t)&&function(e){for(var t=e.userData.animations.singleClick,a=0,n=t.length;a<n;a++)t[a].oneWay=!0;e.userData.animations.click=t,S(e,"click",0)}(t))}function R(e,t){t=_(e.container,t.clientX,t.clientY);w.fromArray(t),T(e.objects,e.camera)}function x(e,t){t=t.changedTouches[0],t=_(e.container,t.clientX,t.clientY);w.fromArray(t),T(e.objects,e.camera)}function C(e,t){t=_(e.container,t.clientX,t.clientY);M.fromArray(t),t=e.objects,e=e.camera,0<(e=y(M,t,e)).length?(e=e[0].object).userData.animations.hover&&!I(e)&&(S(e,"hover",0),L(e)):L()}function S(c,u,e){for(var d=c.userData.animations[u],p=e;p<d.length;p++){var t=H(d[p].object),m=!1;if(t.map(function(r){switch(r.userData[u]||(r.userData[u]={}),r.userData[u][c.uuid+p]=d[p],u){case"click":"custom"===d[p].event?(r.userData.animations.custom=d[p],function(){for(var e=b[r.name],t=r.userData.animations.custom.event_action,a=0;a<e.length;a++){var n=e[a].userData.click;if(n)for(var o in n){var i=n[o];switch(t){case"on":i.active||i.clickOn||D(e[a],o);break;case"off":!i.active&&i.clickOn&&D(e[a],o)}}}}()):"autorotation"===d[p].event?(l=r).userData.autorotation.enabled=!l.userData.autorotation.enabled:"camera_autorotate"===d[p].event?(s=d[p].arguments,h.cameraAnimationHelper.applyAutorotate(s)):"scene_event"===d[p].event?function(e){for(var t in e)"full_screen"===t&&e.full_screen.switch&&THREEx.FullScreen.switch()}(d[p].arguments):"cycle_event"===d[p].event?function(e,t){if(!e.userData.click[t].active){D(e,t);var a=e.userData.click[t].cycle.enabled;if(a)delete e.userData.cycle[t];else{var n=e.userData.click[t].cycle.steps,o=e.userData.click[t].cycle.interval,i=e.userData.click[t].cycle.duration,r=e.userData.click[t].cycle.easing;e.userData.cycle||(e.userData.cycle={}),e.userData.cycle[t]=[];for(var s=0,l=n.length;s<l;s++){var c=THREE.Math.generateUUID();e.userData.cycle[t].push({uuid:c,arguments:n[s],delay:o,duration:i,easing:r})}O(e,t,0)}e.userData.click[t].cycle.enabled=!a}}(r,c.uuid+p):"single_change"===d[p].event?(i=p,D(n=r,(o=c).uuid+i),H(n.userData.click[o.uuid+i].toggle).map(function(e){if(!e.userData.animations.click){var t,arguments={};for(t in n.userData.click[o.uuid+i].backAnimation)arguments[t]=n.userData.click[o.uuid+i].backAnimation[t].end;e.userData.animations.click=[{object:n.userData.click[o.uuid+i].object,event:"single_change",toggle:o.name,arguments:arguments,delay:n.userData.click[o.uuid+i].delay,duration:n.userData.click[o.uuid+i].duration,easing:n.userData.click[o.uuid+i].easing}],e.userData.animations.hover[0].disabled=!1}o.objectsLink.splice(o.objectsLink.indexOf(o),1),-1==e.objectsLink.indexOf(e)&&e.objectsLink.push(e)})):"material_change"===d[p].event?(s=c.uuid+p,s=r.userData.click[s].arguments.material,h.setMaterial(s,r)):"hide_object"===d[p].event?(a=c.uuid+p,r.userData.click[a],r.visible=!1):"show_object"===d[p].event?(a=c.uuid+p,r.userData.click[a],r.visible=!0):"toggle"===d[p].event?(e=r,t=c.uuid+p,e.userData.animations.disabled=e.userData.click[t].disabled):"reset"===d[p].event?(e=r,t=c.uuid+p,e.userData.click[t].delay=0,e.userData.click[t].duration=0,e.userData.click[t].easing=null,D(e,t)):D(r,c.uuid+p);break;case"hover":!function(e,t){var arguments,a,n,o,i,r;e.userData.hover[t].disabled||e.userData.hover[t].active||e.userData.hover[t].afterAnimation||(arguments=e.userData.hover[t].arguments,a=e.userData.hover[t].delay,n=e.userData.hover[t].duration,o=getCurve(e.userData.hover[t].easing),i=e.userData.hover[t].visible,r=k(arguments,e),e.userData.hover[t].backAnimation=r.back,P("hover"+e.uuid,e,r.forward,n,a,o,function(){e.userData.hover[t].active=!1,e.userData.hover[t].afterAnimation=!0,null!=i&&(e.visible=i)}),e.userData.hover[t].active=!0,g.push(e))}(r,c.uuid+p)}var e,t,a,n,o,i,s,l;d[p].sequence&&(r.userData[u][c.uuid+p].sequence={callback:S,args:[c,u,++p]},m=!0)}),m)break}}function H(e){var o=[];return e.split(",").map(function(e){e=e.trim();var t=r.getObjectByProperty("name",e,!0);if(!t)for(var a=0,n=d.length;a<n&&null==(t=d[a].scene.getObjectByProperty("name",e,!0));a++);o.push(t)}),o}function I(e){return e.userData.animations.disabled}function O(e,t,a){var n;e.userData.cycle[t]&&(n=e.userData.cycle[t][a],a=a==e.userData.cycle[t].length-1?0:a+1,n.sequence={callback:O,args:[e,t,a]},e.userData.click[n.uuid]=n,D(e,n.uuid,function(){n.sequence=void 0}))}function D(t,a,n){var arguments,e,o,i,r,s,l,c,u,d,p,m;t.userData.click[a].active&&void 0===n||(arguments=t.userData.click[a].arguments,e=t.userData.click[a].delay,o=t.userData.click[a].duration,i=getCurve(t.userData.click[a].easing),r=t.userData.click[a].visible,s=t.userData.click[a].lookat_camera,l=t.userData.click[a].event_cam,c=t.userData.click[a].easing_cam,u=t.userData.click[a].duration_cam,d=t.userData.click[a].toggle||t.userData.click[a].oneWay,m=t.userData.click[a].event_cam_animations,t.userData.click[a].clickOn&&void 0===n?P("clickOff"+t.uuid+a,t,t.userData.click[a].backAnimation,o,e,i,function(){var e;t.userData.click[a].active=!1,t.userData.click[a].clickOn=!1,null!=r&&(t.visible=!r),null!=s&&(t.lookAtCamera=!s),t.userData.click[a].sequence&&(e=t.userData.click[a].sequence.args,t.userData.click[a].sequence.callback(e[0],e[1],e[2]))}):(p=k(arguments,t),t.userData.click[a].backAnimation=p.back,function(e,t){if(e.userData.hover)for(var a in e.userData.hover)e.userData.hover[a].afterAnimation&&"sprite_obj13"===e.name&&function(arguments){for(var e in t)arguments.backAnimation[e]&&(arguments.backAnimation[e].obj=arguments.backAnimation[e].end=extend({},t[e].end))}(e.userData.hover[a])}(t,p.forward),P("clickOn"+t.uuid+a,t,p.forward,o,e,i,function(){var e;t.userData.click[a].active=!1,t.userData.click[a].clickOn=!0,null!=r&&(t.visible=r),null!=s&&(t.lookAtCamera=s,t.lookAt(f.position),-1==v.indexOf(t)&&v.push(t)),t.userData.click[a].sequence&&(e=t.userData.click[a].sequence.args,t.userData.click[a].sequence.callback(e[0],e[1],e[2])),n&&n(),d&&(t.userData.click[a].clickOn=!1,delete t.userData.click[a])})),l&&h.switchCamera(l,u,c),m&&(m=m,h.cameraAnimationHelper.applyAnimations(m)),t.userData.click[a].active=!0)}function k(arguments,e){var t,a={},n={};for(t in arguments){var o=getDiffArgument(t,e);if(arguments[t]instanceof Object){var i,r={},s={};for(i in arguments[t])"x"!==i&&"y"!==i&&"z"!==i&&"r"!==i&&"g"!==i&&"b"!==i||(r[i]=o[i],s[i]=arguments[t][i])}else"function"!=typeof arguments[t]&&(r=o,s=arguments[t]);n[t]={obj:r,end:s},a[t]={obj:s,end:r}}return{forward:n,back:a}}function L(n){var o;0!=g.length&&(o=setInterval(function(){for(var e=0;e<g.length;e++){var t=g[e];if((!n||n!==t)&&t.userData.hover)for(var a in t.userData.hover)t.userData.hover[a].afterAnimation&&(function(e,t){var a=e.userData.hover[t],n=e.userData.hover[t].visible;P("backHover"+e.uuid,e,a.backAnimation,a.duration,a.delay,getCurve(a.easing),function(){e.userData.hover[t].afterAnimation=!1,null!=n&&(e.visible=!n)})}(t,a),g.splice(g.indexOf(t),1))}0==g.length&&clearInterval(o)},200))}function P(e,t,a,n,o,i,r){null==i?s(e,a,n,o,i,void 0,function(){r(),0<Object.keys(a).length&&A(a,t,"end")}):s(e,a,n,o,i,function(e){A(e,t,"obj")},r)}function A(arguments,e,t){for(var a in arguments){var n=getDiffArgument(a,e);if(arguments[a][t]instanceof Object)for(var o in arguments[a][t])n[o]=arguments[a][t][o];else r=e,s=arguments[i=a][t],l=void 0,1<(l=i.split(".")).length?2==l.length?r[l[0]][l[1]]=s:3==l.length?r[l[0]][l[1]][l[2]]=s:4==l.length?r[l[0]][l[1]][l[2]][l[3]]=s:5==l.length&&(r[l[0]][l[1]][l[2]][l[3]][l[4]]=s):r[i]=s}var i,r,s,l}t(i,"click",R.bind(this,E={container:i,objects:e,camera:f}),!1),t(i,"touchstart",x.bind(this,E),!1),t(i,"mousemove",C.bind(this,E),!1),t(l,"change",function(){if(0!=v.length)for(var e=0;e<v.length;e++)v[e].lookAtCamera&&v[e].lookAt(f.position)},!1)},THREE.CameraAnimationHelper=function(c){var n=c.orbit_controls,u={play:!1,currentFrame:0};function a(e,t){for(var a in e)t?n[t][a]=e[a]:n[a]=e[a]}function d(e,t,a,n){u.currentFrame=t;var o=0;a=a||1,0<t&&(0<(s=e[t].t-e[t-1].t-(+new Date-n))&&(o=s)),u.timeOut&&(o+=u.timeOut,u.timeOut=void 0);var i=e[t++],r=i.position,s=i.t_position,i=i.quaternion,arguments={};r&&(arguments.position={x:r[0]*a,y:r[1]*a,z:r[2]*a}),s&&(arguments.t_position={x:s[0]*a,y:s[1]*a,z:s[2]*a}),i&&(arguments.quaternion={x:i[0]*a,y:i[1]*a,z:i[2]*a,w:i[3]*a}),c.animateCamera("view_animation_"+t,arguments,0,o,function(){u.play&&(t<u.endFrame?t<e.length?d(e,t,a,+new Date):d(e,0,a,+new Date):u.play=!1)})}n.autoRotateSpeed=.5,this.applyAnimations=function(e){var t=e.view,a=c.cameraAnimations[t],t=e.action,n=void 0;switch(u.endFrame=1/0,u.timeOut=e.timeOut,e.fov&&c.camera.fov!=e.fov&&(u.play=!1,n=e.fov,t="play"),e.startFrame&&(u.play=!1,u.currentFrame=e.startFrame,n=c.camera.fov,t="play"),e.playUntilFrame&&(u.play=!1,u.endFrame=e.playUntilFrame,t="play"),t){case"pause":u.play=!1;break;case"stop":u.play=!1,u.currentFrame=0;break;case"play":if(u.play)return;u.play=!0,setTimeout(function(){!function(e,t,a,n,o,i){var r,s,l,arguments;0==t||n?(u.play=!1,l=e[t++],r=l.position,s=l.t_position,l=l.quaternion,arguments={},r&&(arguments.position={x:r[0]*a,y:r[1]*a,z:r[2]*a}),s&&(arguments.t_position={x:s[0]*a,y:s[1]*a,z:s[2]*a}),l&&(arguments.quaternion={x:l[0]*a,y:l[1]*a,z:l[2]*a,w:l[3]*a}),n&&(arguments.fov=n),c.moveCamera("switchCamera_"+t,arguments,o,0,i||"easeOutSine",function(){u.play=!0,d(e,t,a,+new Date)})):d(e,t,a,+new Date)}(a.tracks,u.currentFrame,a.scale,n)},10)}},this.applyOptions=function(e){if(e.userData)for(var t in e.userData)switch(t){case"autorotation":this.applyAutorotate(e.userData.autorotation);break;case"invert":a(e.userData.invert,"invert");break;case"parameters":a(e.userData.parameters)}},this.applyAutorotate=function(e){var t;n.autoRotateSpeed=.5,e.speed&&(n.autoRotateSpeed=e.speed),e.switch?(n.autoRotate=!n.autoRotate,autoRotation.checked=n.autoRotate):(n.autoRotate=e.enable,autoRotation.checked=e.enable),e.delay&&e.enable&&(n.autoRotate=!1,setTimeout(function(){n.autoRotate=!0},e.delay)),t=n.enableDamping,n.autoRotate||(n.enableDamping=!1,setTimeout(function(){n.enableDamping=t},10))}},THREE.CameraAnimationDataLoad=function(i){var n=new THREE.FileLoader;n.load(i.options.camera_animations,function(e){i.cameraAnimations=JSON.parse(e).animations,function t(a){var o=Object.keys(i.cameraAnimations)[a++];i.cameraAnimations[o].tracks=[];var e=i.options.scene_assets_url+i.cameraAnimations[o].path;n.load(e,function(e){JSON.parse(e).space.root.i.map(function(e){if(e.anim){var t=0;e.anim.pos&&0<e.anim.pos.length&&(t=e.anim.pos.length),e.anim.t_pos&&0<e.anim.t_pos.length&&(t=e.anim.t_pos.length),e.anim.rot&&0<e.anim.rot.length&&(t=t<e.anim.rot.length?e.anim.rot.length:t);for(var a=0;a<t;a++){var n={};e.anim.pos&&e.anim.pos[a]&&(n.position=e.anim.pos[a].v,n.t=e.anim.pos[a].t),e.anim.t_pos&&e.anim.t_pos[a]&&(n.t_position=e.anim.t_pos[a].v,n.t=e.anim.t_pos[a].t),e.anim.rot&&e.anim.rot[a]&&(n.quaternion=e.anim.rot[a].v,n.t=e.anim.rot[a].t),i.cameraAnimations[o].tracks[a]=n}}}),a<Object.keys(i.cameraAnimations).length&&t(a)})}(0)})},IonVR.prototype={constructor:IonVR,init:function(){THREE.Cache.enabled=!0,this.initContainer(),this.loadScene(function(){this.initCamera(),this.initRenderer(),this.initWater(),this.fetchWeather(),this.onReady&&(this.onReady(),this.updateSun()),1==ion.options.audio&&ion.initAudio(),this.start(),setTimeout(function(){ion.preloader.stop(),ion.animateParamToSMP2("color",ion.sc.materials.m_cam,{opacity:-.1},2800,easeInOutSine),ion.camera.getObjectByName("audioMain").gain.context.resume()},2800),setTimeout(function(){(ion.sc.objects.cam_mask.visible=!1)!==ion.data.param.animation&&ion.animateHouse()},6e3)})},log:function(){this.options.debug&&window.console&&console.log(arguments)},loadScene:function(n){var o=this;this.showStatus("Loading scene...");var e=this.loader;e.callbackProgress=function(e){o.showStatus("Loading... Models "+e.loadedModels+"/"+e.totalModels+", textures "+e.loadedTextures+"/"+e.totalTextures),o.preloader.updateProgress(e)},THREE.IONLoader&&e.addGeometryHandler("ion",THREE.IONLoader),this.log("load scene",this.options.scene);var t=this.options.scene;e.load(t,function(e,t,a){o.log("load complete",e,t,a),o.initScene(e),ion.options.ready=!0,o.options.debug&&"undefined"!=typeof IonSceneExplorer&&(o.explorer=new IonSceneExplorer(o,e)),n&&n.call(o)})},loadCameraAnimations:function(){new THREE.CameraAnimationDataLoad(this)},loadSecondaryScene:function(n){var o=this;o.preloader.start(),this.showStatus("Loading scene...");var e=new THREE.SceneLoader;e.callbackProgress=function(e){o.showStatus("Loading... Models "+e.loadedModels+"/"+e.totalModels+", textures "+e.loadedTextures+"/"+e.totalTextures),o.preloader.updateProgress(e)},THREE.IONLoader&&e.addGeometryHandler("ion",THREE.IONLoader),this.log("load secondary scene",this.options.secondary_scene),e.load(this.options.secondary_scene,function(e,t,a){o.log("load secondary complete",e,t,a),o.preloader.stop(),o.hideStatus(),o.initSecondaryScene(e),n&&n.call(o)})},setMaterial:function(e,t){var a=this;this.preloader.start(),this.loader.callbackProgress=function(e){a.showStatus("Loading... Textures "+e.loadedTextures+"/"+e.totalTextures),a.preloader.updateProgress(e)},this.loader.newMaterial(e,function(){t.material=a.sc.materials[e],a.applyAnimationToNewMaterial(t),a.preloader.stop(),a.hideStatus(),a.requestRender()})},showCamInfo:function(){null!=this.orbit_controls&&(this.cam_info||(this.cam_info=$c("div"),this.cam_info.id="camera-info",this.container.appendChild(this.cam_info)),this.cam_info.innerHTML='"position": ['+round(this.camera.position.x,100)+","+round(this.camera.position.y,100)+","+round(this.camera.position.z,100)+'],<br />"target": ['+round(this.orbit_controls.target.x,100)+", "+round(this.orbit_controls.target.y,100)+", "+round(this.orbit_controls.target.z,100)+'],<br />"fov": '+round(this.camera.fov,10))},showLiveWeather:function(){this.weather_info||(this.weather_info=$c("div"),this.weather_info.id="weather-info",this.container.appendChild(this.weather_info),this.weather_in=$c("div"),this.weather_in.id="weather-in",this.weather_in.onclick=ion.showUI,this.container.appendChild(this.weather_in),this.weather_sound=$c("div"),this.weather_sound.id="weather-sound",this.weather_sound.onclick=ion.soundSwitch,this.weather_info.appendChild(this.weather_sound),this.weather_bt=$c("div"),this.weather_bt.id="weather-bt",this.weather_bt.onclick=ion.hideUI,this.weather_info.appendChild(this.weather_bt),this.weather_dot=$c("div"),this.weather_dot.id="weather-dot",this.weather_info.appendChild(this.weather_dot),this.weather_text=$c("div"),this.weather_text.id="weather-text",this.weather_info.appendChild(this.weather_text));var e=this.data.param.live_data.current.last_updated,t=new Date(e).toLocaleTimeString(),a=e.substring(8,10),n=e.substring(5,7),o=ion.data.param.months[+n],e=(new DOMParser).parseFromString('<svg class="weather_icon" height="20" viewBox="0 0 30 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.50001 6.75H18.125C18.8419 6.75201 19.5407 6.52573 20.1203 6.10395C20.7 5.68217 21.1302 5.0868 21.3488 4.40409C21.5674 3.72139 21.5629 2.98683 21.336 2.30684C21.1092 1.62685 20.6717 1.03676 20.0869 0.62207C19.5022 0.207381 18.8007 -0.0103669 18.0839 0.000379477C17.3672 0.0111259 16.6724 0.249808 16.1004 0.681841C15.5284 1.11387 15.1088 1.71681 14.9024 2.4033C14.696 3.08978 14.7136 3.82415 14.9525 4.49999H3.50001C3.20164 4.49999 2.91549 4.61852 2.70451 4.8295C2.49353 5.04048 2.37501 5.32663 2.37501 5.62499C2.37501 5.92336 2.49353 6.20951 2.70451 6.42049C2.91549 6.63147 3.20164 6.75 3.50001 6.75ZM17 3.37499C17 3.15249 17.066 2.93498 17.1896 2.74997C17.3132 2.56497 17.4889 2.42077 17.6945 2.33563C17.9001 2.25048 18.1263 2.2282 18.3445 2.27161C18.5627 2.31502 18.7632 2.42216 18.9205 2.5795C19.0779 2.73683 19.185 2.93729 19.2284 3.15551C19.2718 3.37374 19.2495 3.59994 19.1644 3.80551C19.0792 4.01108 18.9351 4.18678 18.75 4.3104C18.565 4.43401 18.3475 4.49999 18.125 4.49999C17.8267 4.49999 17.5405 4.38147 17.3295 4.17049C17.1186 3.95951 17 3.67336 17 3.37499ZM25.875 4.37499C25.3359 4.37651 24.805 4.50716 24.3267 4.75601C23.8484 5.00485 23.4367 5.36466 23.1261 5.8053C22.8154 6.24594 22.6149 6.75459 22.5412 7.28866C22.4675 7.82274 22.5228 8.3667 22.7025 8.875H1.125C0.826633 8.875 0.540484 8.99353 0.329505 9.2045C0.118527 9.41548 0 9.70163 0 10C0 10.2984 0.118527 10.5845 0.329505 10.7955C0.540484 11.0065 0.826633 11.125 1.125 11.125H25.875C26.7701 11.125 27.6286 10.7694 28.2615 10.1365C28.8945 9.50355 29.25 8.6451 29.25 7.75C29.25 6.85489 28.8945 5.99644 28.2615 5.36351C27.6286 4.73057 26.7701 4.37499 25.875 4.37499ZM25.875 8.875C25.6525 8.875 25.435 8.80902 25.25 8.6854C25.065 8.56178 24.9208 8.38608 24.8357 8.18052C24.7505 7.97495 24.7282 7.74875 24.7717 7.53052C24.8151 7.31229 24.9222 7.11184 25.0795 6.9545C25.2369 6.79717 25.4373 6.69002 25.6556 6.64661C25.8738 6.6032 26.1 6.62548 26.3056 6.71063C26.5111 6.79578 26.6868 6.93997 26.8104 7.12498C26.9341 7.30998 27 7.52749 27 7.75C27 8.04837 26.8815 8.33451 26.6705 8.54549C26.4596 8.75647 26.1734 8.875 25.875 8.875ZM21.375 13.25H2.25C1.95163 13.25 1.66549 13.3685 1.45451 13.5795C1.24353 13.7905 1.125 14.0766 1.125 14.375C1.125 14.6734 1.24353 14.9595 1.45451 15.1705C1.66549 15.3815 1.95163 15.5 2.25 15.5H18.2025C17.9636 16.1758 17.946 16.9102 18.1524 17.5967C18.3588 18.2832 18.7784 18.8861 19.3504 19.3182C19.9224 19.7502 20.6172 19.9889 21.3339 19.9996C22.0507 20.0104 22.7522 19.7926 23.337 19.3779C23.9217 18.9632 24.3592 18.3731 24.586 17.6932C24.8129 17.0132 24.8174 16.2786 24.5988 15.5959C24.3802 14.9132 23.95 14.3178 23.3703 13.896C22.7907 13.4743 22.0919 13.248 21.375 13.25ZM21.375 17.75C21.1525 17.75 20.935 17.684 20.75 17.5604C20.565 17.4368 20.4208 17.2611 20.3357 17.0555C20.2505 16.85 20.2282 16.6238 20.2716 16.4055C20.3151 16.1873 20.4222 15.9868 20.5795 15.8295C20.7369 15.6722 20.9373 15.565 21.1556 15.5216C21.3738 15.4782 21.6 15.5005 21.8055 15.5856C22.0111 15.6708 22.1868 15.815 22.3104 16C22.4341 16.185 22.5 16.4025 22.5 16.625C22.5 16.9234 22.3815 17.2095 22.1705 17.4205C21.9595 17.6315 21.6734 17.75 21.375 17.75Z" fill="black" fill-opacity="0.74"/></svg>',"application/xml"),n=(new DOMParser).parseFromString('<svg class="weather_icon" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11 0C4.93263 0 0 4.93263 0 11C0 17.0674 4.93263 22 11 22C17.0674 22 22 17.0674 22 11C22 4.93263 17.0674 0 11 0ZM11 19.8695C6.11368 19.8695 2.13053 15.8863 2.13053 11C2.13053 6.11368 6.11368 2.13053 11 2.13053C15.8863 2.13053 19.8695 6.11368 19.8695 11C19.8695 15.8863 15.8863 19.8695 11 19.8695Z" fill="black" fill-opacity="0.74"/><path d="M14.7286 5.9053L9.24013 8.29056C8.80013 8.47582 8.45276 8.82319 8.2675 9.26319L5.90539 14.7285C5.53487 15.5853 6.41487 16.4653 7.27171 16.0948L12.7601 13.7095C13.2001 13.5242 13.5475 13.1769 13.7328 12.7369L16.0949 7.27161C16.4886 6.39161 15.6086 5.51161 14.7286 5.9053ZM11.9728 11.9727C11.4401 12.5053 10.5833 12.5053 10.0507 11.9727C9.51803 11.44 9.51803 10.5832 10.0507 10.0506C10.5833 9.51793 11.4401 9.51793 11.9728 10.0506C12.5054 10.56 12.5054 11.44 11.9728 11.9727Z" fill="black" fill-opacity="0.74"/></svg>',"application/xml");(new DOMParser).parseFromString('<svg class="weather_icon" width="20" height="20" viewBox="0 0 20 20" fill="black" xmlns="http://www.w3.org/2000/svg"><path d="M11.1785 10L13.831 12.6525C14.156 12.9775 14.1579 13.5025 13.8302 13.8302C13.5047 14.1556 12.9772 14.1557 12.6525 13.831L10 11.1785L7.34747 13.831C7.02252 14.156 6.49754 14.1579 6.16984 13.8302C5.8444 13.5047 5.84427 12.9772 6.16896 12.6525L8.82149 10L6.16896 7.34747C5.84401 7.02252 5.84213 6.49754 6.16984 6.16984C6.49528 5.8444 7.02278 5.84427 7.34747 6.16896L10 8.82149L12.6525 6.16896C12.9775 5.84401 13.5025 5.84213 13.8302 6.16984C14.1556 6.49528 14.1557 7.02278 13.831 7.34747L11.1785 10ZM10 20C4.47715 20 0 15.5228 0 10C0 4.47715 4.47715 0 10 0C15.5228 0 20 4.47715 20 10C20 15.5228 15.5228 20 10 20ZM10 18.3333C14.6024 18.3333 18.3333 14.6024 18.3333 10C18.3333 5.39763 14.6024 1.66667 10 1.66667C5.39763 1.66667 1.66667 5.39763 1.66667 10C1.66667 14.6024 5.39763 18.3333 10 18.3333Z"  fill-opacity="0.5"/></svg>',"application/xml"),(new DOMParser).parseFromString('<svg class="weather_icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.3728 0 0 5.3728 0 12C0 18.6272 5.3728 24 12 24C18.6272 24 24 18.6272 24 12C24 5.3728 18.6272 0 12 0ZM10.6133 17.1797V11.6864C10.6133 11.3186 10.7594 10.9659 11.0195 10.7059C11.2795 10.4458 11.6322 10.2997 12 10.2997C12.3678 10.2997 12.7205 10.4458 12.9805 10.7059C13.2406 10.9659 13.3867 11.3186 13.3867 11.6864V17.1797C13.3867 17.5475 13.2406 17.9002 12.9805 18.1603C12.7205 18.4203 12.3678 18.5664 12 18.5664C11.6322 18.5664 11.2795 18.4203 11.0195 18.1603C10.7594 17.9002 10.6133 17.5475 10.6133 17.1797ZM12 8.78667C11.6704 8.78667 11.3481 8.68892 11.074 8.50578C10.8 8.32265 10.5863 8.06235 10.4602 7.75781C10.3341 7.45326 10.301 7.11815 10.3654 6.79485C10.4297 6.47155 10.5884 6.17458 10.8215 5.94149C11.0546 5.7084 11.3515 5.54967 11.6748 5.48536C11.9982 5.42105 12.3333 5.45405 12.6378 5.5802C12.9423 5.70635 13.2026 5.91997 13.3858 6.19405C13.5689 6.46813 13.6667 6.79036 13.6667 7.12C13.6667 7.56203 13.4911 7.98595 13.1785 8.29851C12.866 8.61107 12.442 8.78667 12 8.78667Z" fill="white"/></svg>',"application/xml");this.weather_dot.innerHTML="●",this.weather_text.innerHTML="&nbsp&nbspAtlantic Ocean, "+o+" "+a+" at "+t+"&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp",this.weather_text.appendChild(e.documentElement),this.weather_text.innerHTML+="&nbsp&nbsp"+round(this.data.param.live_data.current.wind_kph,100)+" km/h&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp",this.weather_text.appendChild(n.documentElement),this.weather_text.innerHTML+="&nbsp&nbsp"+round(this.data.param.live_data.current.wind_degree,100)+"º "+ion.data.param.live_data.current.wind_dir,this.weather_sound.innerHTML="",this.weather_bt.innerHTML="",this.weather_in.innerHTML=""},showUI:function(){document.getElementById("weather-info").style.bottom="0%"},hideUI:function(){document.getElementById("weather-info").style.bottom="-10%"},soundSwitch:function(){1==ion.options.audio?(document.getElementById("weather-sound").style.backgroundColor="#ff532f",document.getElementById("weather-sound").style.opacity=.8,ion.camera.getObjectByName("audioMain").gain.context.resume(),ion.options.audio=!1):(document.getElementById("weather-sound").style.backgroundColor="#818181",ion.camera.getObjectByName("audioMain").gain.context.suspend(),ion.options.audio=!0)},initScene:function(e){for(var t in this.separateInterfaceGroup(e),this.sc=e,this.scene=e.scene,this.main_group=this.scene.getObjectByName("main_group"),this.main_group.children){var a,n=this.main_group.children[t];n instanceof THREE.Mesh&&n.userData&&(n.userData.sub_div&&(a=n.userData.sub_div,this.log("sub div",n.name,a),this.showStatus("Subdividing "+n.name),new THREE.SubdivisionModifier(a).modify(n.geometry)),n.userData.comp_vn&&(this.log("comp vn",n.name),this.showStatus("Computing normals "+n.name),n.geometry.computeVertexNormals()),n.userData.comp_fn&&(this.log("comp fn",n.name),this.showStatus("Computing face normals "+n.name),n.geometry.computeFaceNormals()),n.userData.comp_cn&&(this.log("comp cn",n.name),this.showStatus("Computing centroids "+n.name),n.geometry.computeCentroids()),n.userData.buffer&&this.options.geom_buffer&&THREE.BufferGeometryUtils&&(delete n.geometry.__tmpVertices,this.showStatus("Triangulating "+n.name),THREE.GeometryUtils.triangulateQuads(n.geometry),this.showStatus("Buffering "+n.name),a=THREE.BufferGeometryUtils.fromGeometry(n.geometry),n.geometry.dispose(),n.geometry=a))}var o,i,r;this.log("main_group",this.main_group),this.main_group.rotation.y=this.options.rotate_left,this.log("init_rotation",this.options.rotate_left),this.options.skybox&&((o=THREE.ShaderLib.cube_y).uniforms.tCube.value=this.sc.textures[this.options.skybox_tx],i=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:o.uniforms,depthWrite:!1,side:THREE.BackSide}),new THREE.Mesh(new THREE.CubeGeometry(1e4,1e4,1e4),i).position.set(0,0,0),this.scene.background=this.sc.textures[this.options.skybox_tx]),this.options.sky&&((o=new THREE.DirectionalLight(16706252,this.data.param.sun.intensity)).position.set(380,4.3,123),o.name="sunLight",(i=new THREE.Sky).name="sky",(r=i.material.uniforms).turbidity.value=this.data.param.sky.turbidity,r.rayleigh.value=this.data.param.sky.rayleigh,r.luminance.value=this.data.param.sky.luminance,r.mieCoefficient.value=this.data.param.sky.mieCoefficient,r.mieDirectionalG.value=this.data.param.sky.mieDirectionalG,(r=new THREE.CubeCamera(.1,1,this.data.param.sky.res)).renderTarget.texture.generateMipmaps=!0,r.renderTarget.texture.minFilter=THREE.LinearMipMapLinearFilter,r.name="cubeCamera",this.scene.background=r.renderTarget,this.scene.add(o),this.scene.add(r),this.scene.add(i),ion.sc.objects.house.material[0].envMap=ion.sc.objects.house.material[1].envMap=ion.sc.objects.house.material[2].envMap=r.renderTarget.texture),this.options.lightprobe&&((r=new THREE.LightProbe).name="lightProbe",this.scene.add(r),1==this.options.lightprobe_comp&&r.copy(THREE.LightProbeGenerator.fromCubeTexture(this.sc.textures[this.options.lightprobe_tx])),r.intensity=this.options.lightprobeInt,"env_cube1"==this.options.lightprobe_set?r.sh.fromArray([.21988952323971958,.353873883080967,.5979957196333927,.06558677467388137,.168535799494315,.3727295821407715,-2838907723444506e-29,-3954370089901607e-29,-4022441719324286e-29,2838929245680154e-29,3954331642208093e-29,40224862808547535e-30,-10201367426154214e-31,5862222392184944e-30,-6706257573915519e-30,10201908564157353e-31,-5861917556646891e-30,67057196117202916e-31,.09217011442613726,.10671077188574228,.11792560917973822,-4880465721524953e-34,9756262751934876e-34,-4760480508502691e-33,.15964303814943762,.18482815100295383,.20425278456377272]):"studio1"==this.options.lightprobe_set?r.sh.fromArray([.029401531146369564,.030393056150284967,.03882441978503216,-.006532247813053846,-.006830553369357048,-.00876550792363131,.0054872013622510795,.005761665763592089,.007102911675978676,.001051650901536813,.0008596636445337802,.0006091165567122502,-.0036529445742401667,-.003961831226970255,-.005260862974352544,-.004670203370822745,-.005086150563277629,-.0060334392731383295,-.0005266474551182757,-.0005770949473494129,-.0006364091203026864,.0027920785910252243,.00304628013386876,.004018038061411669,.0005419559484224849,.0005783680671260237,.0008420237221743866]):"ext1"==this.options.lightprobe_set&&r.sh.fromArray([1.0406571709113295,1.161886628443305,1.3063027226917772,-.6490791656527983,-.49548467256667383,-.31325949844248935,.04381565686615428,.06532099855040499,.07807386785800434,.08630908113628857,-.10730147835215309,-.10939680130133521,-.22306053341686657,-.2557966190958097,-.2506786037181489,.020464629184951535,.028274316528776787,.0298683696140515,-.09474396955458116,-.10071400468444641,-.11257025430936203,-.040398956433938614,-.044402750362525285,-.04342718627203005,.14164765158865514,.15794017769014346,.12746705307744025])),this.o=this.sc.objects,this.m=this.sc.materials,this.t=this.sc.textures,this.c=this.sc.cameras,this.pc=this.data.param},updateSun:function(){var e=new Date(ion.data.param.live_data.current.last_updated).getHours()+.016666*new Date(ion.data.param.live_data.current.last_updated).getMinutes(),t=.5+(e-7)/22;t<.55?c=.55:.55<=t&&t<=.95?c=t:.95<t&&(c=.95),e<12?a=e/15:12<=e&&(a=.75-(e-12)/17),this.data.param.sun.inclination=a,this.data.param.sun.azimuth=c;var a,n,o,i,r=this.data.param.sun,s=this.scene.getObjectByName("sunLight"),l=(this.scene.getObjectByName("cubeCamera"),this.scene.getObjectByName("sky"),Math.PI*(a-.5)),t=2*Math.PI*(c-.5),e=r.distance*Math.cos(t),c=r.distance*Math.sin(t)*Math.sin(l),l=r.distance*Math.sin(t)*Math.cos(l),u={r:e,g:c,b:l};function d(){ion.scene.getObjectByName("sky").material.uniforms.sunPosition.value=u,ion.scene.getObjectByName("cubeCamera").update(ion.renderer,ion.scene.getObjectByName("sky"))}function d(){ion.animateParamToSMP("color",ion.scene.getObjectByName("light_cam").color,{r:n,g:o,b:i},800,easeInOutSine)}function d(){ion.animateParamToSMP("color",ion.scene.getObjectByName("light_cam").color,{r:.004,g:.004,b:.02},800,easeInOutSine)}ion.animateParamToSMP6("position",s.position,{x:e,y:c,z:l},800,easeInOutSine),setTimeout(d,900),c=.5<a&&a<1.01?a-.2+.1:.1,ion.animateParamToSMP("intensity",ion.scene.getObjectByName("light_ambient"),{intensity:c},800,easeInOutSine),.46<a&&a<.8?(c=1.5+5.5*(l=-2.2*(-.75+a)),n=0<=(a=.8075-l)&&a<1?a:0,o=0<=(a=.748-l)&&a<1?a:0,i=0<=(l=.612-l)&&l<1?l:0,ion.animateParamToSMP("color",ion.scene.getObjectByName("sunLight").color,{r:n,g:o,b:i},800,easeInOutSine),ion.sc.materials.m_04.envMapIntensity=ion.sc.materials.m_01.envMapIntensity=c):(ion.animateParamToSMP("color",ion.scene.getObjectByName("sunLight").color,{r:.01,g:.01,b:.02},1600,easeInOutSine),ion.sc.materials.m_04.envMapIntensity=ion.sc.materials.m_01.envMapIntensity=7),setTimeout(d,1600)},initAudio:function(){const e=new THREE.AudioListener;e.name="audioMain",this.camera.add(e);const t=new THREE.Audio(e),a=new THREE.AudioLoader;a.load(this.options.audio_track,function(e){t.setBuffer(e),t.setLoop(!0),t.setVolume(.9),t.play()}),this.camera.getObjectByName("audioMain").gain.context.sampleRate=44100},initWater:function(e){var t=new THREE.PlaneBufferGeometry(12e3,12e3),t=new THREE.Water(t,{textureWidth:1024,textureHeight:1024,waterNormals:(new THREE.TextureLoader).load("_yh1/_tex/waternormals.jpg",function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping}),alpha:.7,sunColor:8947848,waterColor:4738132,fogColor:16706252,distortionScale:3.7});t.rotation.x=-Math.PI/2,t.position.y=-24,t.name="water",ion.scene.getObjectByName("main_group").add(t),ion.requestRender()},separateInterfaceGroup:function(e){for(var t=0;;){var a=e.scene.getObjectByName("interface_group"+t++);if(!a)break;var n=new THREE.InterfaceFrame(this,a.userData);e.scene.remove(a),n.scene.add(a),this.interfaces.push(n)}},initSecondaryScene:function(e){this.secondary_sc=e,this.secondary_group=e.scene.getObjectByName("main_group");for(var t=0;t<e.scene.children.length;t++)this.scene.add(e.scene.children[t]);this.secondary_group.rotation.set(this.main_group.rotation.x,this.main_group.rotation.y,this.main_group.rotation.z),this.render()},initContainer:function(){this.options.container&&this.options.container instanceof HTMLElement?this.container=this.options.container:(this.container=$c("div"),document.body.appendChild(this.container)),this.options.showStatus&&(this.status_info=$c("div"),this.status_info.id="status-info",this.container.appendChild(this.status_info),this.showStatus("Loading...")),this.container.style.animationDuration="1s",this.updateAspect()},addCamerasButtons:function(e){if(e){var t,a=this;for(t in this.sc.cameras){var n=$c("a");n.setAttribute("data-target",t),n.innerHTML=t,n.addEventListener("click",function(){var e=this.getAttribute("data-target");return a.switchCamera(e),!1}),e.appendChild(n)}}},initCamera:function(){var e=this,t=this.options.camera.position;this.sc.currentCamera?this.camera=this.sc.currentCamera:any(this.sc.cameras)?this.camera=first(this.sc.cameras):(this.log("create camera"),this.camera=new THREE.PerspectiveCamera(35,this.aspect.width/this.aspect.height,.1,1500),this.camera.position.set(t.x,t.y,t.z)),this.camera.userData.default_position={x:this.camera.position.x,y:this.camera.position.y,z:this.camera.position.z},this.camera.userData.default_fov=this.camera.fov,this.camera.userData.default_target=this.camera.target,this.log("camera",this.camera),this.cam_group=new THREE.Object3D,this.cam_group.add(this.camera),this.scene.add(this.cam_group),window.addEventListener("resize",function(){e.updateCameraAspect()}),"undefined"!=typeof IonMouseControl?this.controls=new IonMouseControl(this,{debug:this.options.debug}):THREE.OrbitControls&&(this.orbit_controls=new THREE.OrbitControls(this.camera,this.container),this.orbit_controls.enableDamping=this.camera.userData.parameters.enableDamping,this.orbit_controls.dampingFactor=this.camera.userData.parameters.dampingFactor,this.orbit_controls.minDistance=this.camera.userData.parameters.minDistance,this.orbit_controls.maxDistance=this.camera.userData.parameters.maxDistance,this.orbit_controls.minPolarAngle=this.camera.userData.parameters.minPolarAngle,this.orbit_controls.maxPolarAngle=this.camera.userData.parameters.maxPolarAngle,this.orbit_controls.panSpeed=this.camera.userData.parameters.panSpeed,this.orbit_controls.rotateSpeed=this.camera.userData.parameters.rotateSpeed,this.orbit_controls.zoomSpeed=this.camera.userData.parameters.zoomSpeed,this.orbit_controls.enableRotate=this.camera.userData.parameters.enableRotate,this.orbit_controls.enableZoom=this.camera.userData.parameters.enableZoom,1==this.camera.userData.parameters.enablePan?this.orbit_controls.enablePan=!0:this.orbit_controls.enablePan=!1,void 0!==this.camera.userData.parameters.screenSpacePanning?this.orbit_controls.screenSpacePanning=this.camera.userData.parameters.screenSpacePanning:this.orbit_controls.screenSpacePanning=!0,this.orbit_controls.addEventListener("change",function(){e.log("cont change"),e.requestRender()}),this.cameraAnimationHelper=new THREE.CameraAnimationHelper(this)),this.options.camera_info&&this.showCamInfo()},updateAspect:function(){this.aspect={width:this.container.clientWidth,height:this.container.clientHeight}},updateCameraAspect:function(){null!=this.renderer&&(this.updateAspect(),this.camera.aspect=this.aspect.width/this.aspect.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.aspect.width,this.aspect.height),this.requestRender())},initRenderer:function(){var e,t,a=this;this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0,powerPreference:"high-performance",precision:"highp"}),this.renderer.gammaFactor=this.options.g_f,this.renderer.gammaInput=this.options.g_in,this.renderer.gammaOutput=this.options.g_out,this.renderer.physicallyBasedShading=this.options.phys_shading,this.renderer.toneMappingExposure=this.options.exposure,this.renderer.setSize(this.aspect.width,this.aspect.height),this.container.appendChild(this.renderer.domElement),this.updateCameraAspect(),this.options.stats&&(this.stats=new Stats,this.container.appendChild(this.stats.domElement),(e=$c("div")).id="render-info",this.container.appendChild(e),this.render_info=$c("pre"),e.appendChild(this.render_info),(t=$c("a")).innerHTML="Refresh",e.appendChild(t),t.addEventListener("click",function(){a.updateRenderInfo()}),this.updateRenderInfo()),this.explorer&&this.explorer.init()},updateRenderInfo:function(){var e=this.renderer.info;this.render_info.innerHTML="<ul><li>memory<ul><li>geometries "+e.memory.geometries+"</li><li>programs "+e.memory.programs+"</li><li>textures "+e.memory.textures+"</li></ul></li><li>render<ul><li>calls "+e.render.calls+"</li><li>faces "+e.render.faces+"</li><li>points "+e.render.points+"</li><li>vertices "+e.render.vertices+"</li></ul></li><li>ts "+Date.now()+"</li></ul>"},showStatus:function(e){var t;this.options.showStatus&&((t=this.status_info).innerHTML=e,t.style.display="block")},hideStatus:function(){this.status_info&&(this.status_info.style.display="none")},start:function(){var r=this,e=+new Date;this.showStatus("Rendering..."),this.animate(),this.animate_simple(),this.hideStatus(),this.log("started",+new Date-e),this.spinRound(),this.animationHelper=new THREE.AnimationsHelper(this,function(e,arguments,t,a,n,o,i){r.animateParamTo(e,arguments,t,a,n,o,i)}),this.requestRender()},requestRender:function(){this.needRender=!0},spinRound:function(){this.options.spin&&(this.animateParamToSMP("rotate",this.main_group.rotation,{x:0,y:this.options.rotate_left+2*Math.PI,z:0},900,easeInOutCubic),this.log("spin"),setTimeout(function(){ion.sc.objects.main_group.rotation.y=ion.options.rotate_left},1e3))},applyAnimationToNewMaterial:function(o){var e=o.userData.click;if(e)for(var t in e){var a=e[t].backAnimation;if(a)for(var n in a)-1<n.indexOf("material")&&function(e,t){if(t instanceof Object){var a,n=getDiffArgument(e,o);for(a in t)n[a]=t[a]}else!function(e,t){var a=e.split(".");1<a.length?2==a.length?o[a[0]][a[1]]=t:3==a.length?o[a[0]][a[1]][a[2]]=t:4==a.length?o[a[0]][a[1]][a[2]][a[3]]=t:5==a.length&&(o[a[0]][a[1]][a[2]][a[3]][a[4]]=t):o[e]=t}(e,t)}(n,e[t].clickOn?a[n].obj:a[n].end)}},animateParamToSky:function(e,t,a,n,o,i){var r,s=extend({},a),l=extend({},a);for(r in a)s[r]=t[r],l[r]=a[r]-t[r];this.animations[e]={obj:t,start:s,delta:l,callback:i,duration:n,easing:o||easeInOutCubic,started:+new Date}},animateParamToSMP:function(e,t,a,n,o,i){var r,s=extend({},a),l=extend({},a);for(r in a)s[r]=t[r],l[r]=a[r]-t[r];this.animations[e]={obj:t,start:s,delta:l,callback:i,duration:n,easing:o||easeInOutCubic,started:+new Date}},animateParamToSMP2:function(e,t,a,n,o,i){var r,s=extend({},a),l=extend({},a);for(r in a)s[r]=t[r],l[r]=a[r]-t[r];this.animations[e]={obj:t,start:s,delta:l,callback:i,duration:n,easing:o||easeInOutCubic,started:+new Date}},animateParamToSMP3:function(e,t,a,n,o,i){var r,s=extend({},a),l=extend({},a);for(r in a)s[r]=t[r],l[r]=a[r]-t[r];this.animations[e]={obj:t,start:s,delta:l,callback:i,duration:n,easing:o||easeInOutCubic,started:+new Date}},animateParamToSMP4:function(e,t,a,n,o,i){var r,s=extend({},a),l=extend({},a);for(r in a)s[r]=t[r],l[r]=a[r]-t[r];this.animations[e]={obj:t,start:s,delta:l,callback:i,duration:n,easing:o||easeInOutCubic,started:+new Date}},animateParamToSMP5:function(e,t,a,n,o,i){var r,s=extend({},a),l=extend({},a);for(r in a)s[r]=t[r],l[r]=a[r]-t[r];this.animations[e]={obj:t,start:s,delta:l,callback:i,duration:n,easing:o||easeInOutCubic,started:+new Date}},animateParamToSMP6:function(e,t,a,n,o,i){var r,s=extend({},a),l=extend({},a);for(r in a)s[r]=t[r],l[r]=a[r]-t[r];this.animations[e]={obj:t,start:s,delta:l,callback:i,duration:n,easing:o||easeInOutCubic,started:+new Date}},animateParamTo:function(e,arguments,t,a,n,o,i){for(var r in this.animations[e]={args:{},callback:o,callbackEnd:i,duration:t,easing:n||easeOutCubic,started:+new Date+a},arguments){if(arguments[r].obj instanceof Object){var s,l={},c={};for(s in arguments[r].obj)0<=["x","y","z","w","r","g","b"].indexOf(s)&&(l[s]=arguments[r].obj[s],c[s]=arguments[r].end[s]);var u,d=extend({},c),p=extend({},c);for(u in c)d[u]=l[u],p[u]=c[u]-l[u]}else d=l=arguments[r].obj,p=(c=arguments[r].end)-l;this.animations[e].args[r]={obj:l,start:d,delta:p}}},setRotation:function(e){this.animateParamToSMP("rotate",this.cam_group.rotation,e,1e3,easeOutCubic)},setFov:function(e){this.animateParamToSMP("fov",this.camera,{fov:e},8e3,easeOutCubic)},switchCamera:function(e,t,a){var n,o,i,r,arguments,s=this,l=this.sc.cameras[e];l&&(null==(n=a||(l.userData?l.userData.easing:void 0))&&(t=0),r=this.camera.name==e?(o=this.camera.userData.default_position,i=this.camera.userData.default_fov,this.camera.userData.default_target):(o=(r=this.sc.cameras[e]).position?{x:r.position.x,y:r.position.y,z:r.position.z}:this.options.camera.position,i=r.fov||this.options.camera.fov,r.target||this.options.camera.target),arguments={position:o,target:r,fov:i,easing:n},this.moveCamera("camera_fov",arguments,t,void 0,n,function(){s.cameraAnimationHelper.applyOptions(l)}))},switchTarget:function(e,t,a){var n,o,i,arguments,r=this,s=this.sc.cameras[e];s&&(null==(n=a||(s.userData?s.userData.easing:void 0))&&(t=0),arguments={target:this.camera.name==e?(i=this.camera.userData.default_fov,this.camera.userData.default_target):(i=(o=this.sc.cameras[e]).fov||this.options.camera.fov,o.target||this.options.camera.target),fov:i,easing:n},this.moveCamera("camera_fov",arguments,t,void 0,n,function(){r.cameraAnimationHelper.applyOptions(s)}))},moveCamera:function(n,arguments,e,t,o,a){var i,r,s,l=this;i=arguments,r=0==e?0:e||1800,s=t||0,l.orbit_controls.focus(i,function(e,arguments,t,a){null==o?(l.container.style.animationName="changeCamera",setTimeout(function(){l.animateParamTo(n,arguments,r,s,getCurve(o),t,a),l.container.style.animationName=""},500)):l.animateParamTo(n,arguments,r,s,getCurve(o),t,a)},a)},animateCamera:function(n,e,o,i,t){var r=this;this.orbit_controls.focus2(e,function(e,arguments,t,a){r.animateParamTo(n,arguments,o,i,null,t,a)},t)},disposeWebGL:function(){var e,t=this;for(e in this.clearScene(this.sc.scene,this.camera),this.animationHelper.dispose(),this.interfaces.map(function(e){t.clearScene(e.scene,e.camera,e.renderer)}),this.sc.cameras){var a=this.sc.cameras[e];t.clearScene(a),a.parent?a.parent.remove(a):this.sc.cameras[e]=null}for(e in this.sc.empties){var n=this.sc.empties[e];t.clearScene(n),n.parent?n.parent.remove(n):this.sc.empties[e]=null}for(e in this.sc.geometries)this.sc.geometries[e].dispose(),this.sc.geometries[e]=null;for(e in this.sc.lights){var o=this.sc.lights[e];o.parent?o.parent.remove(o):this.sc.lights[e]=null}for(e in this.sc.materials){var i=this.sc.materials[e];if(i instanceof THREE.MultiMaterial)for(var r=0;r<i.materials.length;r++)i.materials[r].dispose();else i.dispose();this.sc.materials[e]=null}for(e in this.sc.objects){n=this.sc.objects[e];t.clearScene(n),n.parent?n.parent.remove(n):this.sc.objects[e]=null}for(e in this.sc.textures)this.sc.textures[e].dispose(),this.sc.textures[e]=null;this.orbit_controls.dispose(),this.orbit_controls=null,this.sc.scene=null,this.renderer.dispose(),this.requestRender(),setTimeout(function(){t.renderer=null},0)},clearScene:function(e,t,a){for(var n=e.children;0<n.length;)!function(e){if(e.traverse(function(e){if(e.dispose&&e.dispose(),e.material)if(e.material instanceof THREE.MultiMaterial)for(var t=0;t<e.material.materials.length;t++)e.material.materials[t].dispose();else e.material.dispose();e.geometry&&e.geometry.dispose()}),e.parent.remove(e),e.dispose&&e.dispose(),e.material)if(e.material instanceof THREE.MultiMaterial)for(var t=0;t<e.material.materials.length;t++)e.material.materials[t].dispose();else e.material.dispose();e.geometry&&e.geometry.dispose()}(n[0]);e=e&&null,a&&(a.dispose(),a=null)},animate_simple:function(e){var t=this;requestAnimationFrame(function(e){t.animate_simple(e)},this.renderer.domElement),this.processAnimations()},animate:function(e){var t;null!=this.renderer?((t=this).requestAnimate=requestAnimationFrame(function(e){t.animate(e)},this.renderer.domElement),this.processAnimations2(),this.orbit_controls&&this.orbit_controls.update(),(this.needRender||this.options.always_render)&&(this.render(e),this.needRender=!1),this.options.stats&&this.stats.update()):cancelAnimationFrame(this.requestAnimate)},processAnimations:function(){for(var e in this.animations){var t,a=this.animations[e],n=a.obj,o=+new Date-a.started;for(t in a.start){var i=a.start[t],r=a.delta[t],r=a.easing(o,i,r,a.duration);n[t]=r,n==this.camera&&this.camera.updateProjectionMatrix()}"cam switch"==e&&this.camera.lookAt(this.scene.position),o>a.duration&&(a.callback&&a.callback.call(this,n),delete this.animations[e]),this.requestRender()}},processAnimations2:function(){var e,t=!1;for(e in this.animations){var a=this.animations[e],arguments=a.args,n=+new Date-a.started;if(!(a.started>+new Date)){if(a.easing&&null!=a.easing)for(var o in arguments){var i=arguments[o].start,r=arguments[o].delta;if(arguments[o].obj instanceof Object)for(var s in i){var l=i[s],c=r[s],u=a.easing(n,l,c,a.duration);arguments[o].obj[s]=u}else{u=a.easing(n,i,r,a.duration);arguments[o].obj=u}}a.callback&&a.callback.call(this,arguments),n>a.duration&&(a.callbackEnd&&a.callbackEnd.call(this,arguments),delete this.animations[e]),t=!0}}if(0<Object.keys(this.autorotations).length){var d,r=this.clock.getDelta();for(d in this.autorotations){var p=this.autorotations[d];if(p.userData.autorotation.enabled){for(var m in p.userData.autorotation.speed)p.rotation[m]+=p.userData.autorotation.speed[m]*r;t=!0}}}t&&this.requestRender()},render:function(e){ion.scene.getObjectByName("sky").material.uniforms.sunPosition.value=ion.scene.getObjectByName("sunLight").position,ion.scene.getObjectByName("cubeCamera").update(ion.renderer,ion.scene.getObjectByName("sky")),this.renderer.clear(),this.renderer.render(this.scene,this.camera);var t;performance.now();t=10<=ion.data.param.live_data.current.wind_kph?ion.data.param.live_data.current.wind_kph/8:1,this.sc.objects.main_group.getObjectByName("water").material.uniforms.time.value+=t/100;for(var a=0,n=this.interfaces.length;a<n;a++)this.interfaces[a].renderer.clear(),this.interfaces[a].renderer.render(this.interfaces[a].scene,this.interfaces[a].camera);this.options.camera_info&&this.showCamInfo()},fetchWeather:function(){var e=new Date,t=String(e.getDate()).padStart(2,"0"),a=String(e.getMonth()+1).padStart(2,"0"),t="http://api.weatherapi.com/v1/astronomy.json?key=86e2cee98e40449a969174824200812&q=47.7086, -52.7144&dt="+e.getFullYear()+"-"+a+"-"+t;console.log(t),fetch("http://api.weatherapi.com/v1/current.json?key=86e2cee98e40449a969174824200812&q=47.7086, -52.7144").then(e=>e.json()).then(e=>ion.data.param.live_data=e),setTimeout(function(){ion.updateWeather(),ion.updateSun()},3e3),setTimeout(function(){ion.fetchWeather()},3e5)},updateWeather:function(){var e,a=ion.data.param.live_data.current.wind_degree/57.325,n=ion.data.param.live_data.current.wind_kph/57.325/2,o=ion.data.param.swiv_factor;ion.data.param.live_data.current.wind_degree<45||315<ion.data.param.live_data.current.wind_degree&&ion.data.param.live_data.current.wind_kph<=80?(e=35+ion.data.param.live_data.current.wind_kph/1.66,ion.setFov(e)):ion.data.param.live_data.current.wind_degree<45||315<ion.data.param.live_data.current.wind_degree&&80<ion.data.param.live_data.current.wind_kph?ion.setFov(e):ion.setFov(45);var i=3e5/(ion.data.param.live_data.current.wind_kph/100+1);ion.data.param.live_data.current.wind_degree!==ion.data_stored.param.live_data.current.wind_degree?(ion.animateParamToSMP3("rotate_house",ion.sc.objects.h1_group.rotation,{x:0,y:0,z:a},3e5,easeInOutCubic),ion.data_stored.param.live_data.current.wind_degree=ion.data.param.live_data.current.wind_degree,console.log("rotate house to win direction")):(setTimeout(function(){var e=round(.1*(6*Math.random()+3)+ +o,100),t=round(a+n*e,100);console.log("step one: ",e,"angle: ",t,round(57.325*t,1),"°"),ion.animateParamToSMP3("rotate_house",ion.sc.objects.h1_group.rotation,{x:0,y:0,z:t},i,easeInOutSine)},0),setTimeout(function(){var e=round(.1*(6*Math.random()+3)+ +o,100),t=round(a-n*e,100);console.log("step two: ",e,"angle: ",t,round(57.325*t,1),"°"),ion.animateParamToSMP3("rotate_house",ion.sc.objects.h1_group.rotation,{x:0,y:0,z:t},i,easeInOutSine)},i))},animateHouse:function(){var n,e=ion.data.param.live_data.current.wind_kph;e<=9?n=5e3:e<=29?n=4500:e<=39?n=4e3:e<=49?n=3500:e<=59||e<=79?n=3e3:e<=80&&(n=2800);var o=ion.data.param.wind_factor+e/20,i=ion.data.param.wind_factor+ion.data.param.sway_factor+e/20;ion.data.param.swiv_factor;setTimeout(function(){var e=round(.1*(6*Math.random()+3),100)+.5,t=round(.1*(6*Math.random()+3),100)+.5,a=round(.1*(6*Math.random()+3),100)+.5;ion.animateParamToSMP4("rocking_position",ion.sc.objects.h2_group.position,{y:.1*o*e,z:.1*o*t},n,easeInOutSine),ion.animateParamToSMP2("rocking_rotation",ion.sc.objects.h3_group.rotation,{x:5e-4*i*a,y:.002*i*t},n,easeInOutSine)},0),setTimeout(function(){var e=round(.1*(6*Math.random()+3),100)+.5,t=round(.1*(6*Math.random()+3),100)+.5;round(.1*(6*Math.random()+3),100);ion.animateParamToSMP4("rocking_position",ion.sc.objects.h2_group.position,{y:0,z:-.2*o*e},n,easeInOutSine),ion.animateParamToSMP2("rocking_rotation",ion.sc.objects.h3_group.rotation,{x:-5e-4*i*t,y:-.002*i*e},n,easeInOutSine)},n),setTimeout(function(){var e=round(.1*(6*Math.random()+3),100)+.5,t=round(.1*(6*Math.random()+3),100)+.5,a=round(.1*(6*Math.random()+3),100)+.5;ion.animateParamToSMP4("rocking_position",ion.sc.objects.h2_group.position,{y:.1*o*e,z:.1*o*t},n,easeInOutSine),ion.animateParamToSMP2("rocking_rotation",ion.sc.objects.h3_group.rotation,{x:5e-4*i*a,y:.002*i*t},n,easeInOutSine)},2*n),setTimeout(function(){var e=round(.1*(6*Math.random()+3),100)+.5,t=round(.1*(6*Math.random()+3),100)+.5;round(.1*(6*Math.random()+3),100);ion.animateParamToSMP4("rocking_position",ion.sc.objects.h2_group.position,{y:0,z:-.2*o*e},n,easeInOutSine),ion.animateParamToSMP2("rocking_rotation",ion.sc.objects.h3_group.rotation,{x:-5e-4*i*t,y:-.002*i*e},n,easeInOutSine),!1!==ion.data.param.animation&&setTimeout(ion.animateHouse,n)},3*n)},updateMaterial:function(){this.options,this.sc.objects,this.data.param.mMat;var e=new THREE.TextureLoader,i=(ion.data.param,ion.data.param.materials),r=(ion.data_stored.param,ion.data_stored.param.materials);if(matNoo="mat_01",null!=i[matNoo]){let t=matNoo;var s=t.substring(4,6),l=i[t];r[t];let a=ion.sc.materials.mm_procedural[s-1];s=l.map;let n=l.roughnessMap,o=l.bumpMap;null!=s?i[t].map!=r[t].map?e.load(s,function(e){"albedo"==o&&"albedo"==n?(a.map=a.bumpMap=a.roughnessMap=e,console.log("albedo"+t+"for all")):"albedo"==o&&"albedo"!==n?(a.map=a.bumpMap=e,console.log("albedo"+t+"+ bump")):"albedo"!==o&&"albedo"==n?(a.map=a.roughnessMap=e,console.log("albedo"+t+"+ roughnessMap")):(a.map=e,console.log("albedo"+t+"just map")),e.flipY=!0,e.anisotropy=4,e.repeat.set(l.map_repeat,l.map_repeat),e.wrapS=e.wrapT=1e3,r[t].map=i[t].map,ion.requestRender()},function(e){console.log(e.loaded/e.total*100+"% loaded")}):console.log("albedo_"+t+" no change"):console.log("albedo "+t+" null"),null!=o?i[t].bumpMap!=r[t].bumpMap?"albedo"==o?(r[t].bumpMap=i[t].bumpMap,console.log("bumpMap_"+t+" //skipped")):-1!==o.indexOf("jpg")||-1!==o.indexOf("png")?e.load(o,function(e){"bumpMap"==n?(a.bumpMap=a.roughnessMap=e,console.log("bumpMap"+t+"+ roughnessMap")):(a.bumpMap=e,console.log("bumpMap"+t+"just bumpMap")),e.flipY=!0,e.anisotropy=4,e.repeat.set(l.bumpMap_repeat,l.bumpMap_repeat),e.wrapS=e.wrapT=1e3,r[t].bumpMap=i[t].bumpMap,ion.requestRender()},function(e){console.log(e.loaded/e.total*100+"% loaded")}):console.log("bumpMap_"+t+"//strange case"):(r[t].bumpMap=i[t].bumpMap,console.log("bumpMap_"+t+" no change")):console.log("bumpMap_"+t+"//null"),null!=n?i[t].roughnessMap!=r[t].roughnessMap?"albedo"==n||"bumpMap"==n?(r[t].roughnessMap=i[t].roughnessMap,console.log("roughnessMap_"+t+" //skipped")):-1!==n.indexOf("jpg")||-1!==n.indexOf("png")?e.load(n,function(e){"bumpMap"==o?(a.bumpMap=a.roughnessMap=e,console.log("roughnessMap"+t+"+ bumpMap")):(a.roughnessMap=e,console.log("roughnessMap"+t+"just roughnessMap")),e.flipY=!0,e.anisotropy=4,e.repeat.set(l.bumpMap_repeat,l.bumpMap_repeat),e.wrapS=e.wrapT=1e3,r[t].roughnessMap=i[t].roughnessMap,ion.requestRender()},function(e){console.log(e.loaded/e.total*100+"% loaded")}):console.log("roughnessMap_"+t+"//strange case"):(r[t].roughnessMap=i[t].roughnessMap,console.log("roughnessMap_"+t+" no change")):console.log("roughnessMap_"+t+"//null"),null!=l.color?(p=l.color.h,m=l.color.s,h=l.color.l,a.color.setHSL(p,m,h)):a.color.setHSL(0,0,.5),null!=o&&null!=l.bumpScale?a.bumpScale=l.bumpScale:a.bumpScale=0,null!=l.envMapIntensity?a.envMapIntensity=l.envMapIntensity:a.envMapIntensity=1,null!=l.metalness?a.metalness=l.metalness:a.metalness=0,null!=l.roughness?a.roughness=l.roughness:a.roughness=.5,"MeshPhysicalMaterial"==a.type&&(null!=l.clearCoat?a.clearCoat=l.clearCoat:a.clearCoat=0,null!=l.clearCoatRoughness?a.clearCoatRoughness=l.clearCoatRoughness:a.clearCoatRoughness=0,null!=l.reflectivity?a.reflectivity=l.reflectivity:a.reflectivity=.5),this.applyMaterials(),this.requestRender()}if(matNoo="mat_02",null!=i[matNoo]){let t=matNoo;var c=t.substring(4,6),u=i[t];r[t];let a=ion.sc.materials.mm_procedural[c-1];c=u.map;let n=u.roughnessMap,o=u.bumpMap;null!=c?i[t].map!=r[t].map?e.load(c,function(e){"albedo"==o&&"albedo"==n?(a.map=a.bumpMap=a.roughnessMap=e,console.log("albedo"+t+"for all")):"albedo"==o&&"albedo"!==n?(a.map=a.bumpMap=e,console.log("albedo"+t+"+ bump")):"albedo"!==o&&"albedo"==n?(a.map=a.roughnessMap=e,console.log("albedo"+t+"+ roughnessMap")):(a.map=e,console.log("albedo"+t+"just map")),e.flipY=!0,e.anisotropy=4,e.repeat.set(u.map_repeat,u.map_repeat),e.wrapS=e.wrapT=1e3,r[t].map=i[t].map,ion.requestRender()},function(e){console.log(e.loaded/e.total*100+"% loaded")}):console.log("albedo_"+t+" no change"):console.log("albedo "+t+" null"),null!=o?i[t].bumpMap!=r[t].bumpMap?"albedo"==o?(r[t].bumpMap=i[t].bumpMap,console.log("bumpMap_"+t+" //skipped")):-1!==o.indexOf("jpg")||-1!==o.indexOf("png")?e.load(o,function(e){"bumpMap"==n?(a.bumpMap=a.roughnessMap=e,console.log("bumpMap"+t+"+ roughnessMap")):(a.bumpMap=e,console.log("bumpMap"+t+"just bumpMap")),e.flipY=!0,e.anisotropy=4,e.repeat.set(u.bumpMap_repeat,u.bumpMap_repeat),e.wrapS=e.wrapT=1e3,r[t].bumpMap=i[t].bumpMap,ion.requestRender()},function(e){console.log(e.loaded/e.total*100+"% loaded")}):console.log("bumpMap_"+t+"//strange case"):(r[t].bumpMap=i[t].bumpMap,console.log("bumpMap_"+t+" no change")):console.log("bumpMap_"+t+"//null"),null!=n?i[t].roughnessMap!=r[t].roughnessMap?"albedo"==n||"bumpMap"==n?(r[t].roughnessMap=i[t].roughnessMap,console.log("roughnessMap_"+t+" //skipped")):-1!==n.indexOf("jpg")||-1!==n.indexOf("png")?e.load(n,function(e){"bumpMap"==o?(a.bumpMap=a.roughnessMap=e,console.log("roughnessMap"+t+"+ bumpMap")):(a.roughnessMap=e,console.log("roughnessMap"+t+"just roughnessMap")),e.flipY=!0,e.anisotropy=4,e.repeat.set(u.bumpMap_repeat,u.bumpMap_repeat),e.wrapS=e.wrapT=1e3,r[t].roughnessMap=i[t].roughnessMap,ion.requestRender()},function(e){console.log(e.loaded/e.total*100+"% loaded")}):console.log("roughnessMap_"+t+"//strange case"):(r[t].roughnessMap=i[t].roughnessMap,console.log("roughnessMap_"+t+" no change")):console.log("roughnessMap_"+t+"//null"),null!=u.color?(p=u.color.h,m=u.color.s,h=u.color.l,a.color.setHSL(p,m,h)):a.color.setHSL(0,0,.5),null!=o&&null!=u.bumpScale?a.bumpScale=u.bumpScale:a.bumpScale=0,null!=u.envMapIntensity?a.envMapIntensity=u.envMapIntensity:a.envMapIntensity=1,null!=u.metalness?a.metalness=u.metalness:a.metalness=0,null!=u.roughness?a.roughness=u.roughness:a.roughness=.5,"MeshPhysicalMaterial"==a.type&&(null!=u.clearCoat?a.clearCoat=u.clearCoat:a.clearCoat=0,null!=u.clearCoatRoughness?a.clearCoatRoughness=u.clearCoatRoughness:a.clearCoatRoughness=0,null!=u.reflectivity?a.reflectivity=u.reflectivity:a.reflectivity=.5),this.applyMaterials(),this.requestRender()}if(matNoo="mat_03",null!=i[matNoo]){let t=matNoo;var c=t.substring(4,6),d=i[t];r[t];let a=ion.sc.materials.mm_procedural[c-1];var p,m,h,c=d.map;let n=d.roughnessMap,o=d.bumpMap;null!=c?i[t].map!=r[t].map?e.load(c,function(e){"albedo"==o&&"albedo"==n?(a.map=a.bumpMap=a.roughnessMap=e,console.log("albedo"+t+"for all")):"albedo"==o&&"albedo"!==n?(a.map=a.bumpMap=e,console.log("albedo"+t+"+ bump")):"albedo"!==o&&"albedo"==n?(a.map=a.roughnessMap=e,console.log("albedo"+t+"+ roughnessMap")):(a.map=e,console.log("albedo"+t+"just map")),e.flipY=!0,e.anisotropy=4,e.repeat.set(d.map_repeat,d.map_repeat),e.wrapS=e.wrapT=1e3,r[t].map=i[t].map,ion.requestRender()},function(e){console.log(e.loaded/e.total*100+"% loaded")}):console.log("albedo_"+t+" no change"):console.log("albedo "+t+" null"),null!=o?i[t].bumpMap!=r[t].bumpMap?"albedo"==o?(r[t].bumpMap=i[t].bumpMap,console.log("bumpMap_"+t+" //skipped")):-1!==o.indexOf("jpg")||-1!==o.indexOf("png")?e.load(o,function(e){"bumpMap"==n?(a.bumpMap=a.roughnessMap=e,console.log("bumpMap"+t+"+ roughnessMap")):(a.bumpMap=e,console.log("bumpMap"+t+"just bumpMap")),e.flipY=!0,e.anisotropy=4,e.repeat.set(d.bumpMap_repeat,d.bumpMap_repeat),e.wrapS=e.wrapT=1e3,r[t].bumpMap=i[t].bumpMap,ion.requestRender()},function(e){console.log(e.loaded/e.total*100+"% loaded")}):console.log("bumpMap_"+t+"//strange case"):(r[t].bumpMap=i[t].bumpMap,console.log("bumpMap_"+t+" no change")):console.log("bumpMap_"+t+"//null"),null!=n?i[t].roughnessMap!=r[t].roughnessMap?"albedo"==n||"bumpMap"==n?(r[t].roughnessMap=i[t].roughnessMap,console.log("roughnessMap_"+t+" //skipped")):-1!==n.indexOf("jpg")||-1!==n.indexOf("png")?e.load(n,function(e){"bumpMap"==o?(a.bumpMap=a.roughnessMap=e,console.log("roughnessMap"+t+"+ bumpMap")):(a.roughnessMap=e,console.log("roughnessMap"+t+"just roughnessMap")),e.flipY=!0,e.anisotropy=4,e.repeat.set(d.bumpMap_repeat,d.bumpMap_repeat),e.wrapS=e.wrapT=1e3,r[t].roughnessMap=i[t].roughnessMap,ion.requestRender()},function(e){console.log(e.loaded/e.total*100+"% loaded")}):console.log("roughnessMap_"+t+"//strange case"):(r[t].roughnessMap=i[t].roughnessMap,console.log("roughnessMap_"+t+" no change")):console.log("roughnessMap_"+t+"//null"),null!=d.color?(p=d.color.h,m=d.color.s,h=d.color.l,a.color.setHSL(p,m,h)):a.color.setHSL(0,0,.5),null!=o&&null!=d.bumpScale?a.bumpScale=d.bumpScale:a.bumpScale=0,null!=d.envMapIntensity?a.envMapIntensity=d.envMapIntensity:a.envMapIntensity=1,null!=d.metalness?a.metalness=d.metalness:a.metalness=0,null!=d.roughness?a.roughness=d.roughness:a.roughness=.5,"MeshPhysicalMaterial"==a.type&&(null!=d.clearCoat?a.clearCoat=d.clearCoat:a.clearCoat=0,null!=d.clearCoatRoughness?a.clearCoatRoughness=d.clearCoatRoughness:a.clearCoatRoughness=0,null!=d.reflectivity?a.reflectivity=d.reflectivity:a.reflectivity=.5),this.applyMaterials(),this.requestRender()}},applyMaterials:function(){this.sc.objects},collectData:function(){var e,t=this.ion.skus2,a=this.serialsByTypes={};for(e in t){var n=t[e];a[n.type]=a[n.type]||[],a[n.type].push({title:n.title||e,id:e})}}},THREE.Water=function(e,t){THREE.Mesh.call(this,e);var i=this,a=void 0!==(t=t||{}).textureWidth?t.textureWidth:512,n=void 0!==t.textureHeight?t.textureHeight:512,r=void 0!==t.clipBias?t.clipBias:0,o=void 0!==t.alpha?t.alpha:1,s=void 0!==t.time?t.time:0,l=void 0!==t.waterNormals?t.waterNormals:null,c=void 0!==t.sunDirection?t.sunDirection:new THREE.Vector3(.70707,.70707,0),u=new THREE.Color(void 0!==t.sunColor?t.sunColor:16777215),d=new THREE.Color(void 0!==t.waterColor?t.waterColor:8355711),p=void 0!==t.eye?t.eye:new THREE.Vector3(0,0,0),m=void 0!==t.distortionScale?t.distortionScale:20,h=void 0!==t.side?t.side:THREE.FrontSide,e=void 0!==t.fog&&t.fog,f=new THREE.Plane,g=new THREE.Vector3,v=new THREE.Vector3,b=new THREE.Vector3,y=new THREE.Matrix4,E=new THREE.Vector3(0,0,-1),w=new THREE.Vector4,M=new THREE.Vector3,_=new THREE.Vector3,T=new THREE.Vector4,R=new THREE.Matrix4,x=new THREE.PerspectiveCamera,t={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},C=new THREE.WebGLRenderTarget(a,n,t);THREE.Math.isPowerOfTwo(a)&&THREE.Math.isPowerOfTwo(n)||(C.texture.generateMipmaps=!1);n={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:.7},time:{value:0},size:{value:8},distortionScale:{value:20},textureMatrix:{value:new THREE.Matrix4},sunColor:{value:new THREE.Color(8355711)},sunDirection:{value:new THREE.Vector3(.70707,.70707,0)},eye:{value:new THREE.Vector3},waterColor:{value:new THREE.Color(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;",THREE.ShaderChunk.fog_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.fog_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",THREE.ShaderChunk.common,THREE.ShaderChunk.packing,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_begin,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.shadowmask_pars_fragment,"void main() {","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );",THREE.ShaderChunk.tonemapping_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},e=new THREE.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:THREE.UniformsUtils.clone(n.uniforms),transparent:!0,lights:!0,side:h,fog:e});e.uniforms.mirrorSampler.value=C.texture,e.uniforms.textureMatrix.value=R,e.uniforms.alpha.value=o,e.uniforms.time.value=s,e.uniforms.normalSampler.value=l,e.uniforms.sunColor.value=u,e.uniforms.waterColor.value=d,e.uniforms.sunDirection.value=c,e.uniforms.distortionScale.value=m,e.uniforms.eye.value=p,i.material=e,i.onBeforeRender=function(e,t,a){var n,o;v.setFromMatrixPosition(i.matrixWorld),b.setFromMatrixPosition(a.matrixWorld),y.extractRotation(i.matrixWorld),g.set(0,0,1),g.applyMatrix4(y),M.subVectors(v,b),0<M.dot(g)||(M.reflect(g).negate(),M.add(v),y.extractRotation(a.matrixWorld),E.set(0,0,-1),E.applyMatrix4(y),E.add(b),_.subVectors(v,E),_.reflect(g).negate(),_.add(v),x.position.copy(M),x.up.set(0,1,0),x.up.applyMatrix4(y),x.up.reflect(g),x.lookAt(_),x.far=a.far,x.updateMatrixWorld(),x.projectionMatrix.copy(a.projectionMatrix),R.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),R.multiply(x.projectionMatrix),R.multiply(x.matrixWorldInverse),f.setFromNormalAndCoplanarPoint(g,v),f.applyMatrix4(x.matrixWorldInverse),w.set(f.normal.x,f.normal.y,f.normal.z,f.constant),o=x.projectionMatrix,T.x=(Math.sign(w.x)+o.elements[8])/o.elements[0],T.y=(Math.sign(w.y)+o.elements[9])/o.elements[5],T.z=-1,T.w=(1+o.elements[10])/o.elements[14],w.multiplyScalar(2/w.dot(T)),o.elements[2]=w.x,o.elements[6]=w.y,o.elements[10]=w.z+1-r,o.elements[14]=w.w,p.setFromMatrixPosition(a.matrixWorld),n=e.getRenderTarget(),o=e.vr.enabled,a=e.shadowMap.autoUpdate,i.visible=!1,e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(C),e.clear(),e.render(t,x),i.visible=!0,e.vr.enabled=o,e.shadowMap.autoUpdate=a,e.setRenderTarget(n))}},THREE.Water.prototype=Object.create(THREE.Mesh.prototype),THREE.Water.prototype.constructor=THREE.Water,THREE.Sky=function(){var e=THREE.Sky.SkyShader,e=new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:THREE.UniformsUtils.clone(e.uniforms),side:THREE.BackSide});THREE.Mesh.call(this,new THREE.BoxBufferGeometry(1,1,1),e)},THREE.Sky.prototype=Object.create(THREE.Mesh.prototype),THREE.Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new THREE.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")};var WEBGL={isWebGLAvailable:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},isWebGL2Available:function(){try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},getWebGLErrorMessage:function(){return this.getErrorMessage(1)},getWebGL2ErrorMessage:function(){return this.getErrorMessage(2)},getErrorMessage:function(e){var t={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext},a='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>',n=document.createElement("div");return n.id="webglmessage",n.style.fontFamily="monospace",n.style.fontSize="13px",n.style.fontWeight="normal",n.style.textAlign="center",n.style.background="#fff",n.style.color="#000",n.style.padding="1.5em",n.style.width="400px",n.style.margin="5em auto 0",a=(a=t[e]?a.replace("$0","graphics card"):a.replace("$0","browser")).replace("$1",{1:"WebGL",2:"WebGL 2"}[e]),n.innerHTML=a,n}};THREE.LightProbeGenerator={fromCubeTexture:function(e){for(var t,a,n=0,o=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Color,s=[0,0,0,0,0,0,0,0,0],l=new THREE.SphericalHarmonics3,c=l.coefficients,u=0;u<6;u++){var d=e.image[u],p=d.width,m=d.height,h=document.createElement("canvas");h.width=p,h.height=m;h=h.getContext("2d");h.drawImage(d,0,0,p,m);for(var m=h.getImageData(0,0,p,m),f=m.data,g=m.width,v=2/g,b=0,y=f.length;b<y;b+=4){r.setRGB(f[b]/255,f[b+1]/255,f[b+2]/255),r.copySRGBToLinear(r);var E=b/4,w=(E%g+.5)*v-1,M=1-(Math.floor(E/g)+.5)*v;switch(u){case 0:o.set(-1,M,-w);break;case 1:o.set(1,M,w);break;case 2:o.set(-w,1,-M);break;case 3:o.set(-w,-1,M);break;case 4:o.set(-w,M,1);break;case 5:o.set(w,M,-1)}E=o.lengthSq(),n+=a=4/(Math.sqrt(E)*E),i.copy(o).normalize(),THREE.SphericalHarmonics3.getBasisAt(i,s);for(var _=0;_<9;_++)c[_].x+=s[_]*r.r*a,c[_].y+=s[_]*r.g*a,c[_].z+=s[_]*r.b*a}}t=4*Math.PI/n;for(_=0;_<9;_++)c[_].x*=t,c[_].y*=t,c[_].z*=t;return new THREE.LightProbe(l)}},THREE.Preloader=function(e,o){var a,t,n,i,r;function s(){l()}function l(){var e=window.innerWidth,t=window.innerHeight;a.aspect=e/t,a.updateProjectionMatrix(),n.setSize(e,t)}function c(){n.clear(),n.render(t,a)}this.start=function(){r.style.display="",o.wrapper.style.display="block",i&&cancelAnimationFrame(i),c()},this.stop=function(){cancelAnimationFrame(i),r.style.display="none",o.wrapper.style.display="none"},this.updateProgress=function(e){var t=.33*window.innerWidth,a=e.totalModels+e.totalTextures,n=e.loadedModels+e.loadedTextures;a&&(t=Math.floor(t*n/a)),o.message&&(o.message.innerHTML="Loading... Models "+e.loadedModels+"/"+e.totalModels+", textures "+e.loadedTextures+"/"+e.totalTextures),o.bar.style.width=t+"px"},t=new THREE.Scene,(a=new THREE.PerspectiveCamera(65,window.innerWidth/window.innerHeight,1,1e3)).position.z=100,t.add(a),(n=new THREE.WebGLRenderer({antialias:!0,alpha:!0})).setPixelRatio(window.devicePixelRatio),n.setSize(window.innerWidth,window.innerHeight),n.gammaInput=!0,n.gammaOutput=!0,document.body.insertBefore(n.domElement,o.wrapper),(r=n.domElement).style.position="absolute",r.style.display="none",r.style.zIndex=1006,r.style.top=r.style.left=0,r.style.background="url("+o.background+") no-repeat scroll center center",window.addEventListener("resize",s,!1),l()};
